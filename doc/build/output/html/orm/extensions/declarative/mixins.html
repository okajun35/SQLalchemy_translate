<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        
        <title>
            
    
    ミックスインとカスタムベースクラス
 &mdash;
    SQLAlchemy 1.3 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../../../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../../../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../../../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
        <link rel="copyright" title="Copyright" href="../../../copyright.html" />
    <link rel="top" title="SQLAlchemy 1.3 Documentation" href="../../../index.html" />
        <link rel="up" title="宣言的" href="index.html" />
        <link rel="next" title="宣言的API" href="api.html" />
        <link rel="prev" title="継承の設定" href="inheritance.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">1.3.0b1</span>


        | Release Date: unreleased

    </div>

    <h1>SQLAlchemy 1.3 Documentation</h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">


        <div id="docs-sidebar-popout">
            <h3><a href="../../../index.html">SQLAlchemy 1.3 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../../../contents.html">Contents</a> |
                <a href="../../../genindex.html">Index</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../../../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="../../index.html" title="SQLAlchemy ORM">SQLAlchemy ORM</a>
        </h3>

        <ul>
<li><span class="link-container first"><a class="reference external" href="../../tutorial.html">オブジェクトリレーショナルチュートリアル</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../../mapper_config.html">マッパー設定</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../../relationships.html">関係の設定</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../../loading_objects.html">オブジェクトの読み込み</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../../session.html">セッションの使用</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../../extending.html">イベントと内部</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../index.html">ORM拡張</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="../associationproxy.html">アソシエーションプロキシ</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../automap.html">オートマップ</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../baked.html">焼いたクエリ</a></span></li>
<li><span class="link-container first"><a class="reference external" href="index.html">宣言的</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="basic_use.html">基本的な使用</a></span></li>
<li><span class="link-container first"><a class="reference external" href="relationships.html">関係の設定</a></span></li>
<li><span class="link-container first"><a class="reference external" href="table_config.html">テーブル構成</a></span></li>
<li><span class="link-container first"><a class="reference external" href="inheritance.html">継承の設定</a></span></li>
<li class="selected"><span class="link-container first"><strong>ミックスインとカスタムベースクラス</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#augmenting-the-base">ベースの拡張</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#mixing-in-columns">列の混合</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#mixing-in-relationships">関係の混在</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#using-advanced-relationship-arguments-e-g-primaryjoin-etc">拡張関係引数（例えば、 `` primaryjoin``など）を使用すると、</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="#mixing-in-deferred-column-property-and-other-mapperproperty-classes">deferred（）、column_property（）、およびその他のMapperPropertyクラスを混在させる</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#mixing-in-association-proxy-and-other-attributes">アソシエーションのプロキシとその他の属性の混合</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#controlling-table-inheritance-with-mixins">ミックスインによるテーブル継承の制御</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#mixing-in-columns-in-inheritance-scenarios">継承シナリオでの列の混合</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#combining-table-mapper-arguments-from-multiple-mixins">複数のミックスインからのテーブル/マッパー引数の結合</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#creating-indexes-with-mixins">ミックスインでインデックスを作成する</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="api.html">宣言的API</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="../mutable.html">突然変異の追跡</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../orderinglist.html">オーダーリスト</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../horizontal_shard.html">水平シャーディング</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../hybrid.html">ハイブリッド属性</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../indexable.html">インデックス作成可能</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../instrumentation.html">代替クラスの計装</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="../../examples.html">ORMの例</a></span></li>
</ul>



        </div>

        </div>

    </div>

    

    <div id="docs-body" class="withsidebar" >
        
<div class="section" id="mixin-and-custom-base-classes">
<span id="declarative-mixins"></span><h1>ミックスインとカスタムベースクラス<a class="headerlink" href="#mixin-and-custom-base-classes" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>：mod： <a href="#id1"><span class="problematic" id="id2">`</span></a>〜sqlalchemy.ext.declarative`を使うときの一般的な必要性は、多くのクラスにわたって共通のコラム、いくつかの共通テーブルオプション、または他のマップされたプロパティのようないくつかの機能を共有することです。標準的なPythonのイディオムは、これらの共通の機能を含むベースからクラスを継承することです。</p>
<p>：mod： <a href="#id1"><span class="problematic" id="id2">`</span></a>〜sqlalchemy.ext.declarative`を使うとき、このイディオムは、カスタム宣言的な基本クラスの使用と、プライマリベースに加えて継承される&amp;quot; mixin &amp;quot;クラスの使用によって許可されます。 Declarativeには、マッピングが宣言される方法でこの機能を実現するいくつかのヘルパー機能が含まれています。一般的に混入しているイディオムの例を以下に示します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">MyMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__tablename__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mysql_engine&#39;</span><span class="p">:</span> <span class="s1">&#39;InnoDB&#39;</span><span class="p">}</span>
    <span class="n">__mapper_args__</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;always_refresh&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">MyMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span></pre></div>
</div>
<p>上記のところでは、 `` MyModel``クラスはプライマリキーとして&amp;quot;id &amp;quot;カラム、クラス自体の名前から派生する `` __tab_name``属性、 `` __table_args__``、 `` MyMixin`` mixinクラスによって定義された `` __mapper_args__``です。</p>
<p>`` MyMixin``が `` Base``に先行するかどうかについては、固定された規約はありません。通常のPythonのメソッド解決規則が適用され、上の例は::と同様に動作します</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Base</span><span class="p">,</span> <span class="n">MyMixin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span></pre></div>
</div>
<p>これは `` Base``は `` MyMixin``が定義する変数、 `` __tablename__``、 `` __table_args__``、 `` id``などを定義していないからです。 `` Base``は同じ名前の属性を定義しました。継承リストに最初に置かれたクラスは、新しく定義されたクラスでどの属性が使用されるかを決定します。</p>
<div class="section" id="augmenting-the-base">
<h2>ベースの拡張<a class="headerlink" href="#augmenting-the-base" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>純粋なミックスインを使用することに加えて、このセクションのテクニックのほとんどは、特定のベースから派生したすべてのクラスに適用するパターンのために、ベースクラス自体にも適用できます。これは：func： <cite>.declarative_base`関数の</cite> <a href="#id1"><span class="problematic" id="id2">`</span></a>cls``引数を使って実現します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">Base</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__tablename__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mysql_engine&#39;</span><span class="p">:</span> <span class="s1">&#39;InnoDB&#39;</span><span class="p">}</span>

    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">(</span><span class="bp">cls</span><span class="o">=</span><span class="n">Base</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span></pre></div>
</div>
<p>上記のところで、 `` MyModel``と `` Base``から派生する他のすべてのクラスは、クラス名、 `` id``主キー列、および&amp;quot;InnoDB &amp;quot;から派生したテーブル名を持ちます。 MySQLのエンジン。</p>
</div>
<div class="section" id="mixing-in-columns">
<h2>列の混合<a class="headerlink" href="#mixing-in-columns" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>mixinに列を指定する最も基本的な方法は、単純な宣言:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TimestampMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">TimestampMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>

    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span></pre></div>
</div>
<p>上記のところでは、 `` TimestampMixin``を含む宣言的なクラスには、すべての行の挿入にタイムスタンプを適用する `` created_at``という列もあります。</p>
<p>SQLAlchemy式言語をよく知っている人は、clause要素のオブジェクトIDがスキーマ内での役割を定義していることを知っています。 2つの `` Table``オブジェクト `` a``と `` b``はどちらも `` id``という列を持ちますが、これらが区別される方法は `` acid``と `` bcid``が2つの異なるPythonオブジェクトで、親テーブルをそれぞれ「a」と「b」で参照しています。</p>
<p>mixinカラムの場合、class： <cite>.Column`オブジェクトは明示的に作成されているようですが、上記の最終的な</cite> <a href="#id1"><span class="problematic" id="id2">`</span></a>created_at``カラムは、別々の宛先クラスごとに個別のPythonオブジェクトとして存在しなければなりません。これを実現するために、宣言的拡張は、mixinとして検出されたクラス上で遭遇する各：class： <a href="#id3"><span class="problematic" id="id4">`</span></a>.Column`オブジェクトの**コピー**を作成します。</p>
<p>このコピーメカニズムは、外部キーを持たない単純な列に限定されています。class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.ForeignKey`自体には、このレベルで正しく再作成できない列への参照が含まれています。外部キーを持つカラム、および宛先明示コンテキストを必要とするさまざまなマッパーレベルのコンストラクトの場合、：class： <a href="#id3"><span class="problematic" id="id4">`</span></a>〜.declared_attr`デコレータが提供され、多くのクラスに共通するパターンを呼び出し可能として定義できます。 ：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">ReferenceAddressMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">address_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;address.id&#39;</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">ReferenceAddressMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
<p>上記の場合、 `` address_id``クラスレベルの呼び出し可能関数は、 `` User``クラスが構築された時点で実行され、宣言的拡張は、結果として：class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.Column`オブジェクトを使用することができます。メソッドをコピーする必要はありません。</p>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 0.6.5 で変更: </span>`` sqlalchemy.util.classproperty``の名前をclass： <a href="#id1"><span class="problematic" id="id2">`</span></a>〜.declared_attr`に変更してください。</p>
</div>
<p>：class： <cite>〜.declared_attr`によって生成されたカラムは、</cite> <cite>__mapper_args__``によって、現在</cite> <cite>polymorphic_on``と</cite> <a href="#id1"><span class="problematic" id="id2">`</span></a>version_id_col``によって制限された程度で参照することもできます。宣言的な拡張はクラス構築時にそれらを解決します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyMixin</span><span class="p">:</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">type_</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span><span class="n">type_</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">MyMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span><span class="o">=</span><span class="s1">&#39;test&#39;</span>
    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
</div>
<div class="section" id="mixing-in-relationships">
<h2>関係の混在<a class="headerlink" href="#mixing-in-relationships" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>：func： <cite>〜sqlalchemy.orm.relationship`によって作成されたリレーションシップは、：class：</cite> .declared_attr`アプローチを使用して宣言的なmixinクラスで提供され、リレーションシップとその可能性のある列バインドされたコンテンツをコピーするときに生じる可能性があります。以下は、外部キーの列と関係を組み合わせた例で、 `` Foo``と `` Bar``の2つのクラスを、多対1で共通のターゲットクラスを参照するように設定することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RefTargetMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;target_id&#39;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;target.id&#39;</span><span class="p">))</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Target&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">RefTargetMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">RefTargetMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Target</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;target&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
<div class="section" id="using-advanced-relationship-arguments-e-g-primaryjoin-etc">
<h3>拡張関係引数（例えば、 `` primaryjoin``など）を使用すると、<a class="headerlink" href="#using-advanced-relationship-arguments-e-g-primaryjoin-etc" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>：func： <cite>〜sqlalchemy.orm.relationship`定義は明示的なprimaryjoin、order_byなどを必要とします。しかし、最も単純なケースでは、これらの引数に** late bound **フォームを使用します。ラムダ。なぜなら、 `</cite> &#64; declared_attr``を使って設定される関連する：class： <cite>.Column`オブジェクトは別の</cite> <cite>&#64; declared_attr``属性で利用できないからです。メソッドは動作しnew：class： `.Column`オブジェクトを返しますが、それらは宣言が独自のメソッドを呼び出すときに使用する：class：</cite> .Column`オブジェクトではないので、* different <a href="#id1"><span class="problematic" id="id2">*</span></a>：classを使用します： <a href="#id3"><span class="problematic" id="id4">`</span></a>.Column`オブジェクト。</p>
<p>標準的な例は、別の混在列に依存するprimaryjoin条件です:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RefTargetMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;target_id&#39;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;target.id&#39;</span><span class="p">))</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="n">Target</span><span class="p">,</span>
            <span class="n">primaryjoin</span><span class="o">=</span><span class="n">Target</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="bp">cls</span><span class="o">.</span><span class="n">target_id</span>   <span class="c1"># this is *incorrect*</span>
        <span class="p">)</span></pre></div>
</div>
<p>上記のmixinを使ってクラスをマッピングすると、次のようなエラーが出ます：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">exc</span><span class="o">.</span><span class="n">InvalidRequestError</span><span class="p">:</span> <span class="n">this</span> <span class="n">ForeignKey</span><span class="s1">&#39;s parent column is not</span>
<span class="n">yet</span> <span class="n">associated</span> <span class="k">with</span> <span class="n">a</span> <span class="n">Table</span><span class="o">.</span></pre></div>
</div>
<p>これは、 `` target（） <code class="docutils literal notranslate"><span class="pre">メソッドで呼び出された</span> <span class="pre">``</span> <span class="pre">target_id</span></code>：class： <cite>.Column`は、宣言が実際にマップされるクラス：</cite> .Column`と同じではないからです私たちのテーブル。</p>
<p>上記の条件は、lambda</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RefTargetMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;target_id&#39;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;target.id&#39;</span><span class="p">))</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="n">Target</span><span class="p">,</span>
            <span class="n">primaryjoin</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Target</span><span class="o">.</span><span class="n">id</span><span class="o">==</span><span class="bp">cls</span><span class="o">.</span><span class="n">target_id</span>
        <span class="p">)</span></pre></div>
</div>
<p>または文字列形式（最終的にラムダを生成する）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RefTargetMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;target_id&#39;</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;target.id&#39;</span><span class="p">))</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">target</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Target&quot;</span><span class="p">,</span>
            <span class="n">primaryjoin</span><span class="o">=</span><span class="s2">&quot;Target.id==</span><span class="si">%s</span><span class="s2">.target_id&quot;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="p">)</span></pre></div>
</div>
</div>
</div>
<div class="section" id="mixing-in-deferred-column-property-and-other-mapperproperty-classes">
<h2>deferred（）、column_property（）、およびその他のMapperPropertyクラスを混在させる<a class="headerlink" href="#mixing-in-deferred-column-property-and-other-mapperproperty-classes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以下のような：func： <cite>〜sqlalchemy.orm.relationship</cite>、all：class：<cite>〜sqlalchemy.orm.interfaces.MapperProperty`サブクラス：func： `〜sqlalchemy.orm.deferred</cite>、：func：<a href="#id1"><span class="problematic" id="id2">`</span></a>〜sqlalchemy.orm .column_property`などは最終的にはカラムへの参照を伴うため、宣言的なミックスインとともに使用する場合は、：class： <a href="#id3"><span class="problematic" id="id4">`</span></a>.declared_attr`要件があり、コピーに依存する必要はありません。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomethingMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">dprop</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">deferred</span><span class="p">(</span><span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Something</span><span class="p">(</span><span class="n">SomethingMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s2">&quot;something&quot;</span></pre></div>
</div>
<p>：func： <a href="#id1"><span class="problematic" id="id2">`</span></a>.column_property`や他の構文は、mixinの他の列を参照するかもしれません。これらは、クラス： <a href="#id3"><span class="problematic" id="id4">`</span></a>.declared_attr`が呼び出される前にコピーされます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomethingMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">x_plus_y</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">column_property</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">y</span><span class="p">)</span></pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 1.0.0 で変更: </span>mixinの列は最終的にマッピングされたクラスにコピーされるので、class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.declared_attr`メソッドはマッピングされる実際の列にアクセスできます。</p>
</div>
</div>
<div class="section" id="mixing-in-association-proxy-and-other-attributes">
<h2>アソシエーションのプロキシとその他の属性の混合<a class="headerlink" href="#mixing-in-association-proxy-and-other-attributes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ミックスインは、ユーザ定義の属性だけでなく、func： <cite>.association_proxy`のような他の拡張ユニットも指定できます。 ：class： `.declared_attr`の使用法は、属性をターゲットサブクラスに特別に合わせなければならない場合に必要です。一例は、それぞれが異なるタイプの子オブジェクトを対象とするmultiple：func： `.association_proxy`属性を構築するときです。以下は：func： `.association_proxy</cite> / mixinの例で、文字列値のスカラーリストを実装クラスに提供しています:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">String</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">relationship</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.associationproxy</span> <span class="k">import</span> <span class="n">association_proxy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span><span class="p">,</span> <span class="n">declared_attr</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">HasStringCollection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">_strings</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">StringAttribute</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
            <span class="n">__tablename__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">string_table_name</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span>
                            <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.id&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">),</span>
                            <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">relationship</span><span class="p">(</span><span class="n">StringAttribute</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">strings</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s1">&#39;_strings&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TypeA</span><span class="p">(</span><span class="n">HasStringCollection</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;type_a&#39;</span>
    <span class="n">string_table_name</span> <span class="o">=</span> <span class="s1">&#39;type_a_strings&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TypeB</span><span class="p">(</span><span class="n">HasStringCollection</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;type_b&#39;</span>
    <span class="n">string_table_name</span> <span class="o">=</span> <span class="s1">&#39;type_b_strings&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">(),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
<p>上では、 `` HasStringCollection`` mixinは、 `` StringAttribute``と呼ばれる新たに生成されたクラスを参照する：func： <cite>.relationship`を生成します。 `</cite> StringAttribute``クラスは、それ自身の：class： <cite>.Table`定義で生成されます。これは、親クラスに対してローカルであり、</cite> <cite>HasStringCollection``ミックスインを使用します。また、 `</cite> StringAttribute``インスタンスの `` value``属性への `` strings``属性への参照を代行する：func： <a href="#id1"><span class="problematic" id="id2">`</span></a>.association_proxy`オブジェクトも生成します。</p>
<p>`` TypeA``または `` TypeB``は、コンストラクタ引数 `` strings``、文字列のリスト:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ta</span> <span class="o">=</span> <span class="n">TypeA</span><span class="p">(</span><span class="n">strings</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">TypeA</span><span class="p">(</span><span class="n">strings</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bat&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span></pre></div>
</div>
<p>このリストは、 `` StringAttribute``オブジェクトのコレクションを生成します。これらのオブジェクトは、 `` type_a_strings``または `` type_b_strings``テーブルのいずれかにローカルなテーブルに保持されます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">_strings</span><span class="p">)</span>
<span class="go">[&lt;__main__.StringAttribute object at 0x10151cd90&gt;,</span>
<span class="go">    &lt;__main__.StringAttribute object at 0x10151ce10&gt;]</span></pre></div>
</div>
<p>：func： <cite>.association_proxy`を構築するときは、：class：</cite> .declared_attr`デコレータを使用して、 `` TypeA``と `` TypeB <a href="#id1"><span class="problematic" id="id2">``</span></a>クラス。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 0.8 で追加: </span>：class： <cite>.declared_attr`は：func：</cite> .association_proxy`と同様に、ユーザ定義属性を含むマップされていない属性でも使用できます。</p>
</div>
</div>
<div class="section" id="controlling-table-inheritance-with-mixins">
<span id="decl-mixin-inheritance"></span><h2>ミックスインによるテーブル継承の制御<a class="headerlink" href="#controlling-table-inheritance-with-mixins" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>`` __tablename__``属性は、継承階層の各クラスに使用されるテーブルの名前や、クラスに独自のテーブルがあるかどうかを決定する関数を提供するために使用できます。</p>
<p>これは：class： <cite>.declared_attr`インジケータと</cite> <cite>__tablename __（）</cite> <cite>というメソッドを併用することで実現します。 Declarativeは、特別な名前 `</cite> __tablename__``、 `` __mapper_args__``、 `` __table_args__`` <a href="#id1"><span class="problematic" id="id2">**</span></a>のクラス： <a href="#id3"><span class="problematic" id="id4">`</span></a>.declared_attr`を呼び出す**サブクラスでオーバーライドされている場合を除いて、 <a href="#id5"><span class="problematic" id="id6">*</span></a>。したがって、この関数は、各クラスを個別に受け取り、それぞれに対して正しい答えを提供することを期待する必要があります。</p>
<p>たとえば、すべてのクラスにクラス名に基づいた単純なテーブル名を与えるmixinを作成するには:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">Tablename</span><span class="p">:</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__tablename__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Tablename</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">discriminator</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">}</span>
    <span class="n">primary_language</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span></pre></div>
</div>
<p>あるいは、func： <cite>.has_inherited_table`を使用して、</cite> <cite>__tablename__``関数を変更して、サブクラスに対して</cite> <a href="#id1"><span class="problematic" id="id2">`</span></a>None``を返すことができます。これは、それらのサブクラスが親に対して1つのテーブルの継承でマップされているという影響を与えます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declared_attr</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">has_inherited_table</span>

<span class="k">class</span> <span class="nc">Tablename</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__tablename__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">has_inherited_table</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Tablename</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">discriminator</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="n">primary_language</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">}</span></pre></div>
</div>
</div>
<div class="section" id="mixing-in-columns-in-inheritance-scenarios">
<span id="mixin-inheritance-columns"></span><h2>継承シナリオでの列の混合<a class="headerlink" href="#mixing-in-columns-in-inheritance-scenarios" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>`` __tablename__``と他の特別な名前が：class： <cite>.declared_attr`と一緒に使われるときとは対照的に、カラムとプロパティ（例えば、リレーションシップ、カラムプロパティなど）を混在させると、関数は**階層内の基本クラスのみ**。以下では、 `</cite> Person``クラスだけが `` id``という列を受け取ります。主キーが与えられていない `` Engineer``でマッピングが失敗します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HasId</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">HasId</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;person&#39;</span>
    <span class="n">discriminator</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;engineer&#39;</span>
    <span class="n">primary_language</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">}</span></pre></div>
</div>
<p>通常、結合表の継承では、各サブクラスに明示的に名前が付けられた列が必要です。しかし、この場合、すべてのテーブルに `` id``カラムを持ち、それらを外部キーを介して互いに参照させたいことがあります。 ：attr： <cite>.declared_attr.cascading`モディファイアを使用することで、これをミックスインとして実現することができます。この修飾子は、階層**内の各クラスに対して**ほとんど*（下記の警告を参照）で呼び出される必要があることを示します。 `</cite> __tablename__``と同じように:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HasIdMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="nd">@declared_attr</span><span class="o">.</span><span class="n">cascading</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">has_inherited_table</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;person.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">HasIdMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;person&#39;</span>
    <span class="n">discriminator</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span> <span class="n">discriminator</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;engineer&#39;</span>
    <span class="n">primary_language</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">}</span></pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">：attr： <cite>.declared_attr.cascading`機能は現在、サブクラスが異なる機能や値で属性を上書きできるようにしません**。これは `</cite> &#64; declared_attr``がどのように解決されるかのメカニズムの現在の制限であり、この状態が検出された場合には警告が出されます。この制限は、 `` __tablename__``のような特殊な属性名に対しては存在しません**：attr： <a href="#id1"><span class="problematic" id="id2">`</span></a>.declared_attr.cascading`よりも内部的に解決されます。</p>
</div>
<div class="versionadded">
<p><span class="versionmodified">バージョン 1.0.0 で追加: </span>追加されました：attr： <cite>.declared_attr.cascading</cite>。</p>
</div>
</div>
<div class="section" id="combining-table-mapper-arguments-from-multiple-mixins">
<h2>複数のミックスインからのテーブル/マッパー引数の結合<a class="headerlink" href="#combining-table-mapper-arguments-from-multiple-mixins" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>宣言的なミックスインで `` __table_args__`や `` __mapper_args__``を指定した場合、いくつかのミックスインのいくつかのパラメータをクラス自身で定義したいものと組み合わせることができます。 ：class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.declared_attr`デコレータを使って、複数のコレクションから引き出すユーザ定義の照合ルーチンを作成することができます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declared_attr</span>

<span class="k">class</span> <span class="nc">MySQLSettings</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mysql_engine&#39;</span><span class="p">:</span><span class="s1">&#39;InnoDB&#39;</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">MyOtherMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;info&#39;</span><span class="p">:</span><span class="s1">&#39;foo&#39;</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">MySQLSettings</span><span class="p">,</span> <span class="n">MyOtherMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span><span class="o">=</span><span class="s1">&#39;my_model&#39;</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__table_args__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">MySQLSettings</span><span class="o">.</span><span class="n">__table_args__</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">MyOtherMixin</span><span class="o">.</span><span class="n">__table_args__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args</span>

    <span class="nb">id</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
</div>
<div class="section" id="creating-indexes-with-mixins">
<h2>ミックスインでインデックスを作成する<a class="headerlink" href="#creating-indexes-with-mixins" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ミックスインから派生したすべてのテーブルに適用される名前付き、潜在的にマルチカラムのクラス： <cite>.Index`を定義するには：class：</cite> .Index`の&amp;quot;インライン&amp;quot;形式を使用し、それを `` __table_args__`の一部として確立します。 <a href="#id1"><span class="problematic" id="id2">`</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyMixin</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>

    <span class="nd">@declared_attr</span>
    <span class="k">def</span> <span class="nf">__table_args__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Index</span><span class="p">(</span><span class="s1">&#39;test_idx_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__tablename__</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),)</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">MyMixin</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;atable&#39;</span>
    <span class="n">c</span> <span class="o">=</span>  <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></pre></div>
</div>
</div>
</div>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="inheritance.html" title="previous chapter">継承の設定</a>
        Next:
        <a href="api.html" title="next chapter">宣言的API</a>

    <div id="docs-copyright">
        &copy; <a href="../../../copyright.html">Copyright</a> 2007-2018, the SQLAlchemy authors and contributors.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.1.
    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../../../',
          VERSION:     '1.3.0b1',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../../../_static/detectmobile.js"></script>
    <script type="text/javascript" src="../../../_static/init.js"></script>


    </body>
</html>


