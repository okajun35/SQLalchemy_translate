<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        
        <title>
            
    
    クラス継承階層のマッピング
 &mdash;
    SQLAlchemy 1.3 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
        <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="SQLAlchemy 1.3 Documentation" href="../index.html" />
        <link rel="up" title="マッパー設定" href="mapper_config.html" />
        <link rel="next" title="非伝統的なマッピング" href="nonstandard_mappings.html" />
        <link rel="prev" title="コンポジット列の種類" href="composites.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">1.3.0b1</span>


        | Release Date: unreleased

    </div>

    <h1>SQLAlchemy 1.3 Documentation</h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">


        <div id="docs-sidebar-popout">
            <h3><a href="../index.html">SQLAlchemy 1.3 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../contents.html">Contents</a> |
                <a href="../genindex.html">Index</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="index.html" title="SQLAlchemy ORM">SQLAlchemy ORM</a>
        </h3>

        <ul>
<li><span class="link-container first"><a class="reference external" href="tutorial.html">オブジェクトリレーショナルチュートリアル</a></span></li>
<li><span class="link-container first"><a class="reference external" href="mapper_config.html">マッパー設定</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="mapping_styles.html">マッピングのタイプ</a></span></li>
<li><span class="link-container first"><a class="reference external" href="scalar_mapping.html">列と式のマッピング</a></span></li>
<li class="selected"><span class="link-container first"><strong>クラス継承階層のマッピング</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#joined-table-inheritance">結合されたテーブル継承</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#relationships-with-joined-inheritance">結合された継承との関係</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#loading-joined-inheritance-mappings">結合された継承マッピングのロード</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="#single-table-inheritance">単一テーブル継承</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#relationships-with-single-table-inheritance">単一テーブル継承との関係</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#loading-single-inheritance-mappings">単一継承マッピングのロード</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="#concrete-table-inheritance">具体的なテーブル継承</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#concrete-polymorphic-loading-configuration">コンクリート多形荷重設定</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#abstract-concrete-classes">抽象コンクリートクラス</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#classical-and-semi-classical-concrete-polymorphic-configuration">古典的および準古典的なコンクリート多形構成</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#relationships-with-concrete-inheritance">コンクリート継承との関係</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#loading-concrete-inheritance-mappings">コンクリート継承マッピングのロード</a></span></li>
</ul>
</li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="nonstandard_mappings.html">非伝統的なマッピング</a></span></li>
<li><span class="link-container first"><a class="reference external" href="versioning.html">バージョンカウンタの設定</a></span></li>
<li><span class="link-container first"><a class="reference external" href="mapping_api.html">クラスマッピングAPI</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="relationships.html">関係の設定</a></span></li>
<li><span class="link-container first"><a class="reference external" href="loading_objects.html">オブジェクトの読み込み</a></span></li>
<li><span class="link-container first"><a class="reference external" href="session.html">セッションの使用</a></span></li>
<li><span class="link-container first"><a class="reference external" href="extending.html">イベントと内部</a></span></li>
<li><span class="link-container first"><a class="reference external" href="extensions/index.html">ORM拡張</a></span></li>
<li><span class="link-container first"><a class="reference external" href="examples.html">ORMの例</a></span></li>
</ul>



        </div>

        </div>

    </div>

    

    <div id="docs-body" class="withsidebar" >
        
<div class="section" id="mapping-class-inheritance-hierarchies">
<span id="inheritance-toplevel"></span><h1>クラス継承階層のマッピング<a class="headerlink" href="#mapping-class-inheritance-hierarchies" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>SQLAlchemyは、継承の3つの形式をサポートしています：<strong>単一テーブルの継承</strong>、いくつかのタイプのクラスが単一のテーブルで表現されます**具体的なテーブル継承**、各タイプのクラスは独立したテーブルで表され**結合テーブルの継承**では、クラス階層が従属テーブル間で分割され、各クラスはそのクラスのローカル属性のみを含む独自のテーブルで表されます。</p>
<p>継承の最も一般的な形式は、単一の結合テーブルですが、具体的な継承ではより多くの構成上の課題があります。</p>
<p>マッパが継承関係に設定されている場合、SQLAlchemyは要素を読み込むことができます。term： <a href="#id1"><span class="problematic" id="id2">`</span></a>polymorphically`です。つまり、単一のクエリが複数の型のオブジェクトを返すことができます。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">：ref： <cite>examples_inheritance</cite>  - 結合された、単一の、具体的な継承の完全な例</p>
</div>
<div class="section" id="joined-table-inheritance">
<span id="joined-inheritance"></span><h2>結合されたテーブル継承<a class="headerlink" href="#joined-table-inheritance" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>結合された表の継承では、クラスの階層に沿った各クラスは別個の表で表されます。階層内の特定のサブクラスを照会すると、継承パス内のすべてのテーブルに沿ってSQL JOINとしてレンダリングされます。照会されたクラスが基本クラスである場合、<strong>デフォルトの動作は基本表**のみをSELECTステートメントに組み込むことです。すべての場合において、与えられた行のインスタンスを生成する究極のクラスは、識別子テーブルのカラムまたはベーステーブルに対して動作する式によって決定されます。サブクラスが基本表に対して</strong> <a href="#id1"><span class="problematic" id="id2">**</span></a>のみロードされると、結果として得られるオブジェクトには最初に移入された基本属性があります。サブクラスにローカルな属性は、termにアクセスするときに <a href="#id3"><span class="problematic" id="id4">`</span></a>lazy load`となります。あるいは、デフォルトの動作を変更できるオプションがあり、複数のテーブル/サブクラスに対応する列を前面に表示することができます。</p>
<p>継承された継承階層の基本クラスは、基本クラスの識別子と同様に、多態性の識別器列を参照する追加の引数で構成されます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;employee&#39;</span><span class="p">,</span>
        <span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span><span class="nb">type</span>
    <span class="p">}</span></pre></div>
</div>
<p>上記では、** discriminator <a href="#id1"><span class="problematic" id="id2">**</span></a>として動作するように追加の列 `` type``が設定されています：paramref： <a href="#id3"><span class="problematic" id="id4">`</span></a>.mapper.polymorphic_on`パラメータを使用して設定されています。この列には、行内で表されるオブジェクトのタイプを示す値が格納されます。列には任意のデータ型を使用できますが、文字列と整数が最も一般的です。</p>
<p>多型弁別者の発現は厳密には必要ではないが、多型負荷が望ましい場合には必要である。これを達成する最も簡単な方法は、実表に単純な列を設定することですが、非常に洗練された継承マッピングでは、CASE文などのSQL式を多態性弁別子として構成することさえできます。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">現時点では、継承階層**全体に対して、通常は階層内の最も基本的なクラスに1つのディスクリミネータ列またはSQL式しか構成できません。 &amp;quot;カスケーディング&amp;quot;多態性弁別子式はまだサポートされていません。</p>
</div>
<p>次に、「従業員」の「エンジニア」と「マネージャ」のサブクラスを定義します。それぞれには、それらが表すサブクラスに固有の属性を表す列が含まれています。各テーブルには、親テーブルへの外部キー参照と同様に、主キー列（または複数の列）が含まれている必要があります。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;engineer&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;employee.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">engineer_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;engineer&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;manager&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;employee.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">manager_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;manager&#39;</span><span class="p">,</span>
    <span class="p">}</span></pre></div>
</div>
<p>外部キー制約は、主キー自体と同じ列で確立されることが最も一般的ですが、これは必須ではありません。プライマリキーとは別の列を作成して、外部キーを介して親を参照することもできます。 JOINが基本表からサブクラスに構築される方法も直接カスタマイズ可能ですが、ほとんど必要ありません。</p>
<div class="topic">
<p class="topic-title first">Joined inheritance primary keys</p>
<p>結合表継承構成の1つの自然な効果は、すべてのマップされたオブジェクトの識別が、基本表のみの行から完全に決定できることです。これには明白な利点があるので、SQLAlchemyは結合された継承クラスの主キー列を常に基本表の主キー列とみなします。言い換えれば、 <a href="#id1"><span class="problematic" id="id2">``</span></a>エンジニア <a href="#id3"><span class="problematic" id="id4">``</span></a>と <a href="#id5"><span class="problematic" id="id6">``</span></a>マネージャー <a href="#id7"><span class="problematic" id="id8">``</span></a>のテーブルの `` id``カラムは <a href="#id9"><span class="problematic" id="id10">``</span></a>エンジニア <a href="#id11"><span class="problematic" id="id12">``</span></a>や <a href="#id13"><span class="problematic" id="id14">``</span></a>マネージャ``オブジェクトの検索には使われません。 `` employee.id``が考慮されます。 「engineer.id``と `` manager.id``は、親行がステートメント内で決定されると、結合された行の位置を突き止めるために、パターン全体が適切に動作するためには依然として重要です。</p>
</div>
<p>結合された継承マッピングが完了すると、 `` Employee``に対して照会すると、 `` Employee``、 `` Engineer``、 `` Manager``オブジェクトの組み合わせが返されます。新しく保存された `` Engineer``、 `` Manager``、 `` Employee``オブジェクトは自動的に `` employee.type``カラムに正しいdiscriminatorという値を設定します。 `` manager &amp;#39;&amp;#39; <a href="#id1"><span class="problematic" id="id2">``</span></a>、または `` &amp;quot;employee &amp;quot; <a href="#id3"><span class="problematic" id="id4">``</span></a>に変更することができます。</p>
<div class="section" id="relationships-with-joined-inheritance">
<h3>結合された継承との関係<a class="headerlink" href="#relationships-with-joined-inheritance" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>リレーションシップは、結合されたテーブル継承で完全にサポートされています。継承継承クラスを含む関係は、外部キー制約にも対応する階層内のクラスをターゲットにする必要があります。下記のように、 `` employee``テーブルは `` company``テーブルに戻る外部キー制約を持っているので、 `` Company``と `` Employee``の間に関係が設定されています:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;company&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">employees</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Employee&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;company&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Company&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;employees&quot;</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;employee&#39;</span><span class="p">,</span>
        <span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span><span class="nb">type</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="c1"># ...</span></pre></div>
</div>
<p>外部キー制約がサブクラスに対応する表にある場合、その関係はそのサブクラスをターゲットにする必要があります。以下の例では、 `` manager``から `` company``への外部キー制約があるため、 `` Manager``クラスと `` Company``クラスの関係が確立されています:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;company&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">managers</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Manager&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;company&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;employee&#39;</span><span class="p">,</span>
        <span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span><span class="nb">type</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;manager&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;employee.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">manager_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>

    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Company&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;managers&quot;</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;manager&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="c1"># ...</span></pre></div>
</div>
<p>上の `` Manager``クラスは `` Manager.company``属性を持ちます。 `` Company``には `` employee``と `` manager``テーブルの結合を常にロードする `` Company.managers``属性があります。</p>
</div>
<div class="section" id="loading-joined-inheritance-mappings">
<h3>結合された継承マッピングのロード<a class="headerlink" href="#loading-joined-inheritance-mappings" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>マッパー設定時とクエリ時の両方で照会されるテーブルの設定を含む継承ローディング技術の背景については、ref： <cite>inheritance_loading_toplevel`と：ref：</cite> loading_joined_inheritance`節を参照してください。</p>
</div>
</div>
<div class="section" id="single-table-inheritance">
<span id="single-inheritance"></span><h2>単一テーブル継承<a class="headerlink" href="#single-table-inheritance" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>単一テーブルの継承は、単一のテーブル内のすべてのサブクラスのすべての属性を表します。そのクラスに固有の属性を持つ特定のサブクラスは、行が別の種類のオブジェクトを参照している場合はNULLであるテーブル内の列内にそれらを保持します。</p>
<p>階層内の特定のサブクラスを照会すると、基本表に対してSELECTとしてレンダリングされます。WHERE句には、特定の値を持つ行に、または識別器の列または式に存在する値に行を限定します。</p>
<p>単一テーブルの継承には、結合されたテーブルの継承と比較して単純さの利点があります。表現されたすべてのクラスのオブジェクトをロードするためには、1つのテーブルだけが関与する必要があるため、クエリはずっと効率的です。</p>
<p>単一テーブルの継承設定は、基本クラスだけが `` __tablename__``を指定する点を除いて、結合されたテーブルの継承とよく似ています。また、クラスが互いに区別できるように、基本表にも弁別子列が必要です。</p>
<p>サブクラスがすべての属性のベーステーブルを共有していても、Declarativeを使用するときは：class： <cite>.Column`オブジェクトがサブクラスで指定されている可能性があり、そのサブクラスのみにマッピングされることを示します。 ：class： `.Column`は同じベースに適用されます：class：</cite> .Table` object</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span><span class="nb">type</span><span class="p">,</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;employee&#39;</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">manager_data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;manager&#39;</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;engineer&#39;</span>
    <span class="p">}</span></pre></div>
</div>
<p>派生クラスのマネージャとエンジニアのマッパーは `` __tablename__``を省略して、マップされた独自のテーブルを持たないことを示します。</p>
<div class="section" id="relationships-with-single-table-inheritance">
<h3>単一テーブル継承との関係<a class="headerlink" href="#relationships-with-single-table-inheritance" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>リレーションシップは、単一のテーブル継承で完全にサポートされています。設定は継承継承と同じ方法で行われます。外部キー属性は、関係の&amp;quot;foreign sideである同じクラスになければなりません:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;company&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">employees</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Employee&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;company&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Company&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;employees&quot;</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;employee&#39;</span><span class="p">,</span>
        <span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span><span class="nb">type</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">manager_data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;manager&#39;</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;engineer&#39;</span>
    <span class="p">}</span></pre></div>
</div>
<p>また、継承継承の場合と同様に、特定のサブクラスを含むリレーションシップを作成できます。照会されると、SELECTステートメントには、クラス選択をそのサブクラスまたはサブクラスに限定するWHERE句が含まれます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;company&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">managers</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Manager&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;company&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;employee&#39;</span><span class="p">,</span>
        <span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span><span class="nb">type</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">manager_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>

    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Company&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;managers&quot;</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;manager&#39;</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span><span class="s1">&#39;engineer&#39;</span>
    <span class="p">}</span></pre></div>
</div>
<p>上の `` Manager``クラスは `` Manager.company``属性を持ちます。 `` Company``には `` Company.managers``属性があり、 `` employee``に対して `` type = &amp;#39;manager&amp;#39;``の行に制限するWHERE句が追加されています。</p>
</div>
<div class="section" id="loading-single-inheritance-mappings">
<h3>単一継承マッピングのロード<a class="headerlink" href="#loading-single-inheritance-mappings" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>単一テーブル継承の読み込み手法は、結合テーブルの継承に使用されるものとほとんど同じであり、これらの2つのマッピングタイプの間で高度な抽象化が提供されるため、それらの間で切り替えたり、単一の階層（いずれかのサブクラスが単一継承されるものから `` __tablename__``を省略します）。マッパー設定時とクエリ時の両方で照会されるクラスの設定を含む、継承ローディング手法に関するドキュメントについては、ref： <cite>inheritance_loading_toplevel`と：ref：</cite> loading_single_inheritance`節を参照してください。</p>
</div>
</div>
<div class="section" id="concrete-table-inheritance">
<span id="concrete-inheritance"></span><h2>具体的なテーブル継承<a class="headerlink" href="#concrete-table-inheritance" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>具象継承は各サブクラスをそれ自身の別個のテーブルにマップし、それぞれはそのクラスのインスタンスを生成するために必要なすべての列を含みます。コンクリートの継承設定は、デフォルトでは非ポリモーフィックにクエリされます。特定のクラスのクエリはそのクラスのテーブルのみをクエリし、そのクラスのインスタンスのみを返します。具象クラスの多態的なロードは、マッパー内で通常はすべてのテーブルのUNIONとして生成される特殊なSELECTを構成することによって有効になります。</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">具体的なテーブルの継承は**結合**または単一のテーブルの継承より**はるかに複雑**であり、特に関係性、熱心な読み込み、および多相ロードでそれを使用することに関連する**機能ははるかに制限されています**。多態的に使用されると、単純な結合と同様に機能しないUNIONSを伴う**非常に大きなクエリ**が生成されます。リレーションシップロードと多型ロードの柔軟性が必要な場合は、可能な限り結合された単一のテーブル継承を使用することを強くお勧めします。多相ローディングが必要ない場合は、各クラスが独自のテーブルを完全に参照する場合は、継承しない非継承マッピングを使用できます。</p>
</div>
<p>結合された単一テーブルの継承は&amp;quot;ポリモーフィックローディング&amp;quot;に堪能ですが、具体的な継承の方が面倒です。<strong>多態的なローディングが不要な**具体的な継承がより適切です</strong>。継承クラスももっと厄介です。</p>
<p>具体的な継承を使用するクラスを確立するには、 `` __mapper_args__``の中に：paramref： <a href="#id1"><span class="problematic" id="id2">`</span></a>.mapper.concrete`パラメータを追加します。これは、スーパークラスのテーブルをマッピングの一部とみなしてはならないことを、宣言とマッピングに示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;manager&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">manager_data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;engineer&#39;</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span></pre></div>
</div>
<p>2つの重要な点に注意する必要があります。</p>
<ul class="simple">
<li><strong>同じ名前のものであっても、各サブクラスですべての列を明示的に**定義する必要があります。 `` Employee.name``などのカラムは、 `` Manager``や `` Engineer``でマップされたテーブルにコピーされません</strong>。</li>
<li>`` Engineer``と <a href="#id1"><span class="problematic" id="id2">``</span></a>Manager``クラスは` <cite>Employee``との継承関係にマップされていますが、まだ** **多型ロードは含まれていません**。つまり、 `</cite> Employee``オブジェクトを問い合わせると、 `` manager``と `` engineer``のテーブルはまったく問い合わせされません。</li>
</ul>
<div class="section" id="concrete-polymorphic-loading-configuration">
<span id="concrete-polymorphic"></span><h3>コンクリート多形荷重設定<a class="headerlink" href="#concrete-polymorphic-loading-configuration" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>具象継承を伴うポリモーフィックなロードでは、ポリモーフィックなローディングが必要な各基本クラスに対して特殊なSELECTを構成する必要があります。このSELECTは、マップされたすべてのテーブルに個別にアクセスできる必要があります。通常、SQLAlchemyヘルパー：func： <a href="#id1"><span class="problematic" id="id2">`</span></a>.polymorphic_union`を使用して構築されたUNION文です。</p>
<p>：ref： <cite>inheritance_loading_toplevel`で説明したように、：paramref：</cite> .mapper.with_polymorphic`引数を使用して、デフォルトで特別な選択肢からロードするように、任意のタイプのマッパー継承設定を設定できます。現在のパブリックAPIでは、この引数が最初に構築されたときに：class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.Mapper`に設定されている必要があります。</p>
<p>しかし、Declarativeの場合、マッピングされている：class： <cite>.Table`は、マップされたクラスが定義された瞬間に作成されます。つまり、：paramref： `.mapper.with_polymorphic`引数は、サブクラスに対応する：class：</cite> .Table`オブジェクトがまだ定義されていないため、まだ提供できません。</p>
<p>このサイクルを解決するための戦略がいくつかありますが、Declarativeではhelperクラス（class： <cite>.ConcreteBase</cite>）と：class：` .AbstractConcreteBase`が提供されています。</p>
<p>：class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.ConcreteBase`を使うと、継承マッピングの他の形式とほぼ同じ方法で具体的なマッピングを設定できます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">ConcreteBase</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">ConcreteBase</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;employee&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;manager&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">manager_data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;manager&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;engineer&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span></pre></div>
</div>
<p>上記のDeclarativeは、マッパー&amp;quot;初期化&amp;quot;時に `` Employee``クラスの多型選択を設定します。これは、他の従属マッパーを解決するマッパーの後半の設定ステップです。 ：class： <cite>.ConcreteBase`ヘルパーは：func：</cite> .polymorphic_union`関数を使用して、他のすべてのクラスが設定された後にすべての具体的にマップされたテーブルのUNIONを作成し、このステートメントを既存のベースクラスマッパー。</p>
<p>selectを実行すると、多態式共用体は次のような問合せを生成します。</p>
<div class="highlight-python+sql notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<div class='show_sql'>
SELECT
    pjoin.id AS pjoin_id,
    pjoin.name AS pjoin_name,
    pjoin.type AS pjoin_type,
    pjoin.manager_data AS pjoin_manager_data,
    pjoin.engineer_info AS pjoin_engineer_info
FROM (
    SELECT
        employee.id AS id,
        employee.name AS name,
        CAST(NULL AS VARCHAR(50)) AS manager_data,
        CAST(NULL AS VARCHAR(50)) AS engineer_info,
        &#39;employee&#39; AS type
    FROM employee
    UNION ALL
    SELECT
        manager.id AS id,
        manager.name AS name,
        manager.manager_data AS manager_data,
        CAST(NULL AS VARCHAR(50)) AS engineer_info,
        &#39;manager&#39; AS type
    FROM manager
    UNION ALL
    SELECT
        engineer.id AS id,
        engineer.name AS name,
        CAST(NULL AS VARCHAR(50)) AS manager_data,
        engineer.engineer_info AS engineer_info,
        &#39;engineer&#39; AS type
    FROM engineer
) AS pjoin</div></pre></div>
</div>
<p>上記のUNIONクエリは、特定のサブクラスのメンバーではない列に対応するために、各サブテーブルの&amp;quot;NULL &amp;quot;列を作成する必要があります。</p>
</div>
<div class="section" id="abstract-concrete-classes">
<h3>抽象コンクリートクラス<a class="headerlink" href="#abstract-concrete-classes" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>これまで説明した具体的なマッピングでは、サブクラスと基本クラスの両方が個々のテーブルにマッピングされています。具体的な継承ユースケースでは、基本クラスはデータベース内では表現されず、サブクラスのみで表現されるのが一般的です。つまり、基本クラスは「抽象的な」です。</p>
<p>通常、2つの異なるサブクラスを個々のテーブルにマップし、ベースクラスをマッピングしないままにしたい場合は、これを非常に簡単に行うことができます。 Declarativeを使うときは、 `` __abstract__``インジケータで基本クラスを宣言してください:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__abstract__</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;manager&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">manager_data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;manager&#39;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;engineer&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">,</span>
    <span class="p">}</span></pre></div>
</div>
<p>上記では、SQLAlchemyの継承マッピング機能を実際に使用していません。通常は `` Manager``と `` Engineer``のインスタンスをロードして永続させることができます。しかし、多態的に**を問い合わせる必要がある場合は状況が変わります。つまり、 `` session.query（Employee） <a href="#id1"><span class="problematic" id="id2">``</span></a>を出して、 `` Manager``と `` Engineer``のコレクションを取得したいとします。インスタンス。これは具体的な継承の領域に戻ります。これを達成するために、従業員に対する特別なマッパーを構築する必要があります。</p>
<div class="topic">
<p class="topic-title first">Mappers can always SELECT</p>
<p>SQLAlchemyでは、クラスのマッパーは、通常は：class： <cite>.Table`であるが、任意の：func：</cite> .select`オブジェクトも参照することができる、いくつかの&amp;quot;selectable &amp;quot;を参照する必要があります。 &amp;quot;単一テーブル継承&amp;quot;マッパーがテーブルにマップされていないように見えるかもしれませんが、これらのマッパーは実際には暗黙的にスーパークラスによってマップされたテーブルを参照します。</p>
</div>
<p>ポリモーフィックなローディングが可能な抽象的なベースを示すために具体的な継承の例を変更するには、エンジニアとマネージャーの両方のテーブルと `` employee``テーブルしか持たない`` Employee`マッパーは、：paramref： <a href="#id1"><span class="problematic" id="id2">`</span></a>.mapper.with_polymorphic`パラメーターに対してローカルに指定するのではなく、&amp;quot; polymorphic union &amp;quot;に直接マップされます。</p>
<p>これを助けるために、Declarativeは：class： <cite>.AcstractConcreteBase`という名前の：class：</cite> .ConcreteBase`クラスのバリエーションを提供します：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">AbstractConcreteBase</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">AbstractConcreteBase</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;manager&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">manager_data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;manager&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;engineer&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span></pre></div>
</div>
<p>：class： <cite>.AbstractConcreteBase`ヘルパークラスは：class：</cite> .ConcreteBase`よりも複雑な内部処理をしています。基本クラスのマッピング全体は、すべてのサブクラスが宣言されるまで遅らせる必要があります。上記のようなマッピングでは、 `` Manager``と `` Engineer``のインスタンスだけが表示されます。 `` Employee``クラスに対して照会すると、常に `` Manager``と `` Engineer``オブジェクトが生成されます。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">：ref： <cite>declarative_concrete_table</cite>  - 宣言的なリファレンスドキュメント</p>
</div>
</div>
<div class="section" id="classical-and-semi-classical-concrete-polymorphic-configuration">
<h3>古典的および準古典的なコンクリート多形構成<a class="headerlink" href="#classical-and-semi-classical-concrete-polymorphic-configuration" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>：class： <cite>.ConcreteBase`と：class：</cite> .AbstractConcreteBase`は、：func： <a href="#id1"><span class="problematic" id="id2">`</span></a>.polymorphic_union`を明示的に使用する他の2つの設定と同等です。これらのコンフィグレーションフォームは、：class： <a href="#id3"><span class="problematic" id="id4">`</span></a>.Table`オブジェクトを明示的に使用して、&amp;quot;ポリモーフィックユニオン&amp;quot;を最初に作成してマッピングに適用できるようにします。 ：func： <a href="#id5"><span class="problematic" id="id6">`</span></a>.polymorphic_union`関数のマッピングの役割を明確にするためにここに示します。</p>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>半古典的なマッピング**例えばDeclarativeを使用しますが、class： <a href="#id3"><span class="problematic" id="id4">`</span></a>.Table`オブジェクトを別個に確立します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metadata</span> <span class="o">=</span> <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span>

<span class="n">employees_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;employee&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
<span class="p">)</span>

<span class="n">managers_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;manager&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;manager_data&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
<span class="p">)</span>

<span class="n">engineers_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
    <span class="s1">&#39;engineer&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;engineer_info&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">)),</span>
<span class="p">)</span></pre></div>
</div>
<p>次に、UNIONは以下を使用して生成されます：func： <cite>.polymorphic_union</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">polymorphic_union</span>

<span class="n">pjoin</span> <span class="o">=</span> <span class="n">polymorphic_union</span><span class="p">({</span>
    <span class="s1">&#39;employee&#39;</span><span class="p">:</span> <span class="n">employees_table</span><span class="p">,</span>
    <span class="s1">&#39;manager&#39;</span><span class="p">:</span> <span class="n">managers_table</span><span class="p">,</span>
    <span class="s1">&#39;engineer&#39;</span><span class="p">:</span> <span class="n">engineers_table</span>
<span class="p">},</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;pjoin&#39;</span><span class="p">)</span></pre></div>
</div>
<p>上記の：class： <cite>.Table`オブジェクトでは、マッピングは&amp;quot; semi-classical &amp;quot;スタイルを使用して生成できます。ここではDeclarativeを</cite> <cite>__table__``引数とともに使用します。上記のポリモーフィックな共用は `</cite> __mapper_args__``を介して：paramref： <a href="#id1"><span class="problematic" id="id2">`</span></a>.mapper.with_polymorphic`パラメータに渡されます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__table__</span> <span class="o">=</span> <span class="n">employee_table</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span> <span class="n">pjoin</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
        <span class="s1">&#39;with_polymorphic&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">pjoin</span><span class="p">),</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;employee&#39;</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__table__</span> <span class="o">=</span> <span class="n">engineer_table</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__table__</span> <span class="o">=</span> <span class="n">manager_table</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;manager&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span></pre></div>
</div>
<p>代わりに、同じ：class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.Table`オブジェクトは、宣言型を全く使わずに、完全に&amp;quot;古典的な &amp;quot;スタイルで使うことができます。 Declarativeによって提供されるコンストラクタに似たコンストラクタが示されています:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">employee_mapper</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">Employee</span><span class="p">,</span> <span class="n">pjoin</span><span class="p">,</span>
                                    <span class="n">with_polymorphic</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">pjoin</span><span class="p">),</span>
                                    <span class="n">polymorphic_on</span><span class="o">=</span><span class="n">pjoin</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<span class="n">manager_mapper</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">Manager</span><span class="p">,</span> <span class="n">managers_table</span><span class="p">,</span>
                                    <span class="n">inherits</span><span class="o">=</span><span class="n">employee_mapper</span><span class="p">,</span>
                                    <span class="n">concrete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">polymorphic_identity</span><span class="o">=</span><span class="s1">&#39;manager&#39;</span><span class="p">)</span>
<span class="n">engineer_mapper</span> <span class="o">=</span> <span class="n">mapper</span><span class="p">(</span><span class="n">Engineer</span><span class="p">,</span> <span class="n">engineers_table</span><span class="p">,</span>
                                    <span class="n">inherits</span><span class="o">=</span><span class="n">employee_mapper</span><span class="p">,</span>
                                    <span class="n">concrete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                    <span class="n">polymorphic_identity</span><span class="o">=</span><span class="s1">&#39;engineer&#39;</span><span class="p">)</span></pre></div>
</div>
<p>&amp;quot;抽象&amp;quot;の例は、&amp;quot;半古典&amp;quot;または&amp;quot;古典&amp;quot;スタイルを使用してマップすることもできます。相違点は、&amp;quot;polymorphic union &amp;quot;を：paramref： <a href="#id1"><span class="problematic" id="id2">`</span></a>.mapper.with_polymorphic`パラメータに適用するのではなく、ベースマップマッパー上のマップされた選択肢として直接適用する点です。準古典的なマッピングは以下の通りです:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">polymorphic_union</span>

<span class="n">pjoin</span> <span class="o">=</span> <span class="n">polymorphic_union</span><span class="p">({</span>
    <span class="s1">&#39;manager&#39;</span><span class="p">:</span> <span class="n">managers_table</span><span class="p">,</span>
    <span class="s1">&#39;engineer&#39;</span><span class="p">:</span> <span class="n">engineers_table</span>
<span class="p">},</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;pjoin&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__table__</span> <span class="o">=</span> <span class="n">pjoin</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_on&#39;</span><span class="p">:</span> <span class="n">pjoin</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
        <span class="s1">&#39;with_polymorphic&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;employee&#39;</span>
    <span class="p">}</span>

<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__table__</span> <span class="o">=</span> <span class="n">engineer_table</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__table__</span> <span class="o">=</span> <span class="n">manager_table</span>
    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;manager&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span></pre></div>
</div>
<p>上記では、 `` employee``テーブルを省略した点を除いて、前と同じ方法で：func： <a href="#id1"><span class="problematic" id="id2">`</span></a>.polymorphic_union`を使用します。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p class="last">：ref： <cite>classical_mapping</cite>  -  &amp;quot;古典的な&amp;quot;マッピングに関する背景情報</p>
</div>
</div>
<div class="section" id="relationships-with-concrete-inheritance">
<h3>コンクリート継承との関係<a class="headerlink" href="#relationships-with-concrete-inheritance" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>具体的な継承シナリオでは、異なるクラスがテーブルを共有しないため、マッピング関係は困難です。以前の例の `` Company``と `` Manager``の関係のような特定のクラスのみが関連している場合は、関連する2つのテーブルなので特別なステップは必要ありません。</p>
<p>しかし、 `` Company``が `` Employee``と1対多の関係を持ち、 `` Engineer``と <a href="#id1"><span class="problematic" id="id2">``</span></a>Manager``オブジェクトの両方を含むコレクションであることを示しているならば、` ` Employee``は多態的なローディング機能を持っていなければなりません。関連する各テーブルは `` company``テーブルへの外部キーを持っていなければなりません。このような構成の例は、次のとおりです。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">ConcreteBase</span>


<span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;company&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">employees</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Employee&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">ConcreteBase</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;employee&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;manager&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">manager_data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;manager&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;engineer&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span></pre></div>
</div>
<p>具体的な継承と関係を持つ次の複雑さは、「従業員」、「マネージャー」、「エンジニア」のいずれかまたはすべてが「会社」を参照するようにしたいときです。この場合、SQLAlchemyは `` Company`` <a href="#id1"><span class="problematic" id="id2">**</span></a>にリンクしている `` Employee``に置かれた：func： <cite>.relationship`が</cite> <cite>Manager``と</cite> <cite>Manager``に対して動作しないという特別な振る舞いをしています。エンジニア授業は、インスタンスレベルで行使されたとき。代わりに、distinct：func： `.relationship`を各クラスに適用する必要があります。 `</cite> Company.employees``の反対の役割を果たす3つの別々の関係の双方向性を実現するために、：paramref： <a href="#id3"><span class="problematic" id="id4">`</span></a>.relationship.back_populates`パラメータは各関係の間で使用されます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">ConcreteBase</span>


<span class="k">class</span> <span class="nc">Company</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;company&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">employees</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Employee&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;company&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">ConcreteBase</span><span class="p">,</span> <span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;employee&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Company&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;employees&quot;</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;employee&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;manager&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">manager_data</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Company&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;employees&quot;</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;manager&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">Engineer</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;engineer&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
    <span class="n">engineer_info</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">40</span><span class="p">))</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;company.id&#39;</span><span class="p">))</span>
    <span class="n">company</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Company&quot;</span><span class="p">,</span> <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;employees&quot;</span><span class="p">)</span>

    <span class="n">__mapper_args__</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;polymorphic_identity&#39;</span><span class="p">:</span> <span class="s1">&#39;engineer&#39;</span><span class="p">,</span>
        <span class="s1">&#39;concrete&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span></pre></div>
</div>
<p>上記の制限は現在の実装に関連しています。具体的な継承クラスはスーパークラスの属性のいずれも共有しないため、設定する明確な関係が必要です。</p>
</div>
<div class="section" id="loading-concrete-inheritance-mappings">
<h3>コンクリート継承マッピングのロード<a class="headerlink" href="#loading-concrete-inheritance-mappings" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>具象継承によるロードのオプションは限られています。一般に、宣言的コンクリートミックスインの1つを使用してマッパー上に多型ロードが設定されている場合、現在のSQLAlchemyバージョンではクエリ時に変更することはできません。通常、：func： <a href="#id1"><span class="problematic" id="id2">`</span></a>.orm.with_polymorphic`関数は、コンクリートで使用される読み込みのスタイルをオーバーライドすることができますが、現在の制限のため、これはまだサポートされていません。</p>
</div>
</div>
</div>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="composites.html" title="previous chapter">コンポジット列の種類</a>
        Next:
        <a href="nonstandard_mappings.html" title="next chapter">非伝統的なマッピング</a>

    <div id="docs-copyright">
        &copy; <a href="../copyright.html">Copyright</a> 2007-2018, the SQLAlchemy authors and contributors.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.1.
    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../',
          VERSION:     '1.3.0b1',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../_static/detectmobile.js"></script>
    <script type="text/javascript" src="../_static/init.js"></script>


    </body>
</html>


