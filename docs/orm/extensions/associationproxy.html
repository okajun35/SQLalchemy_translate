<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">



<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        
        <title>
            
    
    アソシエーションプロキシ
 &mdash;
    SQLAlchemy 1.3 Documentation

        </title>

        
            <!-- begin iterate through site-imported + sphinx environment css_files -->
                <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/docs.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/changelog.css" type="text/css" />
                <link rel="stylesheet" href="../../_static/sphinx_paramlinks.css" type="text/css" />
            <!-- end iterate through site-imported + sphinx environment css_files -->
        

        

    

    <!-- begin layout.mako headers -->

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
        <link rel="copyright" title="Copyright" href="../../copyright.html" />
    <link rel="top" title="SQLAlchemy 1.3 Documentation" href="../../index.html" />
        <link rel="up" title="ORM拡張" href="index.html" />
        <link rel="next" title="オートマップ" href="automap.html" />
        <link rel="prev" title="ORM拡張" href="index.html" />
    <!-- end layout.mako headers -->


    </head>
    <body>
        
















<div id="docs-container">





<div id="docs-top-navigation-container" class="body-background">
<div id="docs-header">
    <div id="docs-version-header">
        Release: <span class="version-num">1.3.0b1</span>


        | Release Date: unreleased

    </div>

    <h1>SQLAlchemy 1.3 Documentation</h1>

</div>
</div>

<div id="docs-body-container">

    <div id="fixed-sidebar" class="withsidebar">


        <div id="docs-sidebar-popout">
            <h3><a href="../../index.html">SQLAlchemy 1.3 Documentation</a></h3>
            <p id="sidebar-topnav">
                <a href="../../contents.html">Contents</a> |
                <a href="../../genindex.html">Index</a>
            </p>

            <div id="sidebar-search">
                <form class="search" action="../../search.html" method="get">
                  <label>
                  Search terms:
                  <input type="text" placeholder="search..." name="q" size="12" />
                  </label>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </div>

        </div>

        <div id="docs-sidebar">

        <div id="sidebar-banner">
            
        </div>

        <div id="docs-sidebar-inner">

        
        <h3>
            <a href="../index.html" title="SQLAlchemy ORM">SQLAlchemy ORM</a>
        </h3>

        <ul>
<li><span class="link-container first"><a class="reference external" href="../tutorial.html">オブジェクトリレーショナルチュートリアル</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../mapper_config.html">マッパー設定</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../relationships.html">関係の設定</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../loading_objects.html">オブジェクトの読み込み</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../session.html">セッションの使用</a></span></li>
<li><span class="link-container first"><a class="reference external" href="../extending.html">イベントと内部</a></span></li>
<li><span class="link-container first"><a class="reference external" href="index.html">ORM拡張</a></span><ul>
<li class="selected"><span class="link-container first"><strong>アソシエーションプロキシ</strong><a class="paramlink headerlink reference internal" href="#">¶</a></span><ul>
<li><span class="link-container first"><a class="reference external" href="#simplifying-scalar-collections">スカラーコレクションの単純化</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#creation-of-new-values">新しい価値の創造</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#simplifying-association-objects">関連オブジェクトの簡略化</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#proxying-to-dictionary-based-collections">辞書ベースのコレクションへのプロキシ</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#composite-association-proxies">複合アソシエーションプロキシ</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#querying-with-association-proxies">アソシエーションプロキシを使用したクエリ</a></span></li>
<li><span class="link-container first"><a class="reference external" href="#api-documentation">APIドキュメント</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="automap.html">オートマップ</a></span></li>
<li><span class="link-container first"><a class="reference external" href="baked.html">焼いたクエリ</a></span></li>
<li><span class="link-container first"><a class="reference external" href="declarative/index.html">宣言的</a></span></li>
<li><span class="link-container first"><a class="reference external" href="mutable.html">突然変異の追跡</a></span></li>
<li><span class="link-container first"><a class="reference external" href="orderinglist.html">オーダーリスト</a></span></li>
<li><span class="link-container first"><a class="reference external" href="horizontal_shard.html">水平シャーディング</a></span></li>
<li><span class="link-container first"><a class="reference external" href="hybrid.html">ハイブリッド属性</a></span></li>
<li><span class="link-container first"><a class="reference external" href="indexable.html">インデックス作成可能</a></span></li>
<li><span class="link-container first"><a class="reference external" href="instrumentation.html">代替クラスの計装</a></span></li>
</ul>
</li>
<li><span class="link-container first"><a class="reference external" href="../examples.html">ORMの例</a></span></li>
</ul>



        </div>

        </div>

    </div>

    

    <div id="docs-body" class="withsidebar" >
        
<div class="section" id="module-sqlalchemy.ext.associationproxy">
<span id="association-proxy"></span><span id="associationproxy-toplevel"></span><h1>アソシエーションプロキシ<a class="headerlink" href="#module-sqlalchemy.ext.associationproxy" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>`` associationproxy``は、関係をまたいだターゲット属性の読み取り/書き込みビューを作成するために使用されます。基本的に2つのエンドポイント間の&amp;quot;middle &amp;quot;属性の使用を隠し、関連オブジェクトのコレクションからフィールドをチェリーピックするか、関連オブジェクトパターンを使用する冗長性を減らすために使用できます。創造的に適用されるアソシエーションプロキシは、透過的に構成された標準のリレーショナルパターンを使用してデータベースに保存された、あらゆるジオメトリの洗練されたコレクションと辞書ビューの構築を可能にします。</p>
<div class="section" id="simplifying-scalar-collections">
<h2>スカラーコレクションの単純化<a class="headerlink" href="#simplifying-scalar-collections" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>`` User``と `` Keyword``の2つのクラス間の多対多マッピングを考えてみましょう。それぞれの `` User``は任意の数の `` Keyword``オブジェクトを持つことができ、その逆もあります（多対多パターンはref： <a href="#id1"><span class="problematic" id="id2">`</span></a>relationships_many_to_many`で説明されています）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">relationship</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Keyword&quot;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">userkeywords_table</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="k">class</span> <span class="nc">Keyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;keyword&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;keyword&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyword</span> <span class="o">=</span> <span class="n">keyword</span>

<span class="n">userkeywords_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="s1">&#39;userkeywords&#39;</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;user.id&quot;</span><span class="p">),</span>
           <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;keyword_id&#39;</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s2">&quot;keyword.id&quot;</span><span class="p">),</span>
           <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span></pre></div>
</div>
<p>`` User``に関連付けられた&amp;quot;keyword &amp;quot;文字列のコレクションを読み込んで操作するには、各コレクション要素から `` .keyword``属性までのトラバーサルが必要です。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s1">&#39;jek&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">kw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Keyword</span><span class="p">(</span><span class="s1">&#39;cheese inspector&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">kw</span><span class="p">)</span>
<span class="go">[&lt;__main__.Keyword object at 0x12bf830&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">kw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keyword</span><span class="p">)</span>
<span class="go">cheese inspector</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">([</span><span class="n">keyword</span><span class="o">.</span><span class="n">keyword</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">kw</span><span class="p">])</span>
<span class="go">[&#39;cheese inspector&#39;]</span></pre></div>
</div>
<p>`` association_proxy``は `` User``クラスに適用され、 `` kw``関係の&amp;quot;view &amp;quot;を生成します。これは各 `` .keyword``に関連付けられた `` .keyword``の文字列値だけを公開します。 <a href="#id1"><span class="problematic" id="id2">`</span></a>Keyword`オブジェクト:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy.ext.associationproxy</span> <span class="k">import</span> <span class="n">association_proxy</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Keyword&quot;</span><span class="p">,</span> <span class="n">secondary</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">userkeywords_table</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="c1"># proxy the &#39;keyword&#39; attribute from the &#39;kw&#39; relationship</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s1">&#39;kw&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">)</span></pre></div>
</div>
<p>`` .keywords``コレクションは、読み書き可能な文字列のリストとして参照できるようになりました。新しい `` Keyword``オブジェクトが私たちのために透明に作成されます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s1">&#39;jek&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;cheese inspector&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span>
<span class="go">[&#39;cheese inspector&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;snack ninja&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">kw</span>
<span class="go">[&lt;__main__.Keyword object at 0x12cdd30&gt;, &lt;__main__.Keyword object at 0x12cde30&gt;]</span></pre></div>
</div>
<p>：func： <cite>.association_proxy`関数によって生成される：class：</cite> .AssociationProxy`オブジェクトは <a href="#id1"><span class="problematic" id="id2">`</span></a>Python記述子のインスタンスです&lt;<a class="reference external" href="http://docs.python.org/howto/descriptor.html">http://docs.python.org/howto/descriptor.html</a>&gt; <a href="#id3"><span class="problematic" id="id4">`</span></a>_。 ：func： <a href="#id5"><span class="problematic" id="id6">`</span></a>.mapper`関数による宣言的または古典的なマッピングが使用されているかどうかにかかわらず、常にユーザー定義のクラスがマッピングされて宣言されます。</p>
<p>操作に応答して基礎となるマップされた属性またはコレクションを操作することによるプロキシ関数、およびプロキシを介して行われた変更は、マップされた属性で直ちに明らかになります。基本属性は完全にアクセス可能なままです。</p>
<p>最初にアクセスされるとき、アソシエーションプロキシは、その動作が正しく対応するように、ターゲットコレクションに対してイントロスペクション操作を実行します。ローカルにプロキシされた属性が（典型的なように）コレクションであるかスカラー参照であるか、コレクションがセット、リスト、または辞書のように動作するかどうかなどの詳細は、プロキシが基になるコレクションまたは属性が行います。</p>
</div>
<div class="section" id="creation-of-new-values">
<h2>新しい価値の創造<a class="headerlink" href="#creation-of-new-values" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>リストappend（）イベント（またはset add（）、dictionary __setitem __（）、またはスカラー割り当てイベント）がアソシエーションプロキシによって傍受されると、そのコンストラクタを使用して&amp;quot;intermediary &amp;quot;オブジェクトの新しいインスタンスをインスタンス化し、指定された値を1つの引数として取ります。上記の例では、:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;cheese inspector&#39;</span><span class="p">)</span></pre></div>
</div>
<p>アソシエーションプロキシによって動作に変換されます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span><span class="o">.</span><span class="n">kw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Keyword</span><span class="p">(</span><span class="s1">&#39;cheese inspector&#39;</span><span class="p">))</span></pre></div>
</div>
<p>この例は、 `` Keyword``のコンストラクタが単一の位置引数 `` keyword``を受け入れるように設計しているため、ここで動作します。単一引数のコンストラクタが実現できない場合、アソシエーションプロキシの作成動作は、 `` creator``引数を使用してカスタマイズすることができます。これは、単数型の場合に新しいオブジェクトインスタンスを生成する呼び出し可能な（Python関数）引数。以下では典型的なラムダを使用してこれを説明します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="c1"># use Keyword(keyword=kw) on append() events</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s1">&#39;kw&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">,</span>
                    <span class="n">creator</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kw</span><span class="p">:</span> <span class="n">Keyword</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="n">kw</span><span class="p">))</span></pre></div>
</div>
<p>`` creator``関数は、リストベースまたは集合ベースのコレクションの場合は単一の引数を受け取り、スカラー属性を受け取ります。辞書ベースのコレクションの場合、&amp;quot;key &amp;quot;と&amp;quot;value &amp;quot;という2つの引数を受け取ります。これの例は：ref： <a href="#id1"><span class="problematic" id="id2">`</span></a>proxying_dictionaries`です。</p>
</div>
<div class="section" id="simplifying-association-objects">
<h2>関連オブジェクトの簡略化<a class="headerlink" href="#simplifying-association-objects" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>&amp;quot;連想オブジェクト&amp;quot;パターンは、多対多の関係の拡張形式で、ref： <a href="#id1"><span class="problematic" id="id2">`</span></a>association_pattern`に記述されています。アソシエーションプロキシは、通常の使用中に&amp;quot;関連オブジェクト&amp;quot;を保持するのに便利です。</p>
<p>上記の `` userkeywords``表に、明示的にマップしたい追加の列があるとしますが、ほとんどの場合、これらの属性に直接アクセスする必要はありません。以下に、前述の `` userkeywords``テーブルにマップされた `` UserKeyword``クラスを紹介する新しいマッピングを示します。このクラスは、特別なカラム `` special_key``を追加します。これは、時々アクセスしたい値ですが、通常はそうではありません。 `` User``の `` User`keyコレクションから `` .keyword``属性までのギャップを橋渡しする `` User``クラスの `` Keywords``に関連プロキシを作成します各 `` UserKeyword``</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">backref</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.ext.associationproxy</span> <span class="k">import</span> <span class="n">association_proxy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

    <span class="c1"># association proxy of &quot;user_keywords&quot; collection</span>
    <span class="c1"># to &quot;keyword&quot; attribute</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s1">&#39;user_keywords&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="k">class</span> <span class="nc">UserKeyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user_keyword&#39;</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keyword_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;keyword.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">special_key</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>

    <span class="c1"># bidirectional attribute/collection of &quot;user&quot;/&quot;user_keywords&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">User</span><span class="p">,</span>
                <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s2">&quot;user_keywords&quot;</span><span class="p">,</span>
                                <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># reference to the &quot;Keyword&quot; object</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Keyword&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">special_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyword</span> <span class="o">=</span> <span class="n">keyword</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">special_key</span> <span class="o">=</span> <span class="n">special_key</span>

<span class="k">class</span> <span class="nc">Keyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;keyword&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;keyword&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyword</span> <span class="o">=</span> <span class="n">keyword</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Keyword(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyword</span><span class="p">)</span></pre></div>
</div>
<p>上記の設定では、各 `` User``オブジェクトの `` .keywords``コレクションを操作することができ、 `` UserKeyword``の使用法は隠蔽されています:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Keyword</span><span class="p">(</span><span class="s1">&#39;new_from_blammo&#39;</span><span class="p">),</span> <span class="n">Keyword</span><span class="p">(</span><span class="s1">&#39;its_big&#39;</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
<span class="go">[Keyword(&#39;new_from_blammo&#39;), Keyword(&#39;its_big&#39;)]</span></pre></div>
</div>
<p>上記の場合、 `` .keywords.append（） <a href="#id1"><span class="problematic" id="id2">``</span></a>の各操作は、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">user_keywords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UserKeyword</span><span class="p">(</span><span class="n">Keyword</span><span class="p">(</span><span class="s1">&#39;its_heavy&#39;</span><span class="p">)))</span></pre></div>
</div>
<p>`` UserKeyword``関連オブジェクトには、ここに2つの属性が設定されています。 `` .keyword``属性は、 `` Keyword``オブジェクトを最初の引数として渡した結果として直接読み込まれます。 `` User.user_keywords``と `` UserKeyword &amp;#39;の間で双方向の関係が設定されている `` User.user_keywords``コレクションに `` UserKeyword``オブジェクトが追加されるときに `` .user``引数が割り当てられます。 user``は、 `` UserKeyword.user``属性の集団になります。上の `` special_key``引数はデフォルト値 `` None``のままです。</p>
<p>`` special_key``に値を持たせたい場合、 `` UserKeyword``オブジェクトを明示的に作成します。以下の3つの属性をすべて割り当てます。 `` .user``の割り当ては、 `` User.user_keywords``コレクションに `` UserKeyword``が追加される効果を持っています:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">UserKeyword</span><span class="p">(</span><span class="n">Keyword</span><span class="p">(</span><span class="s1">&#39;its_wood&#39;</span><span class="p">),</span> <span class="n">user</span><span class="p">,</span> <span class="n">special_key</span><span class="o">=</span><span class="s1">&#39;my special key&#39;</span><span class="p">)</span></pre></div>
</div>
<p>アソシエーションプロキシは、これらすべての操作によって表される `` Keyword``オブジェクトのコレクションを返します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span>
<span class="go">[Keyword(&#39;new_from_blammo&#39;), Keyword(&#39;its_big&#39;), Keyword(&#39;its_heavy&#39;), Keyword(&#39;its_wood&#39;)]</span></pre></div>
</div>
</div>
<div class="section" id="proxying-to-dictionary-based-collections">
<span id="proxying-dictionaries"></span><h2>辞書ベースのコレクションへのプロキシ<a class="headerlink" href="#proxying-to-dictionary-based-collections" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>アソシエーションプロキシは辞書ベースのコレクションにもプロキシすることができます。 SQLAlchemyのマッピングでは、通常、：func： <cite>.attribute_mapped_collection`コレクション型を使用して辞書コレクションを作成します。また、ref：</cite> dictionary_collections &amp;#39;で説明されている拡張テクニックもあります。</p>
<p>アソシエーションプロキシは、辞書ベースのコレクションの使用を検出すると、その動作を調整します。新しい値が辞書に追加されると、アソシエーションプロキシは、キー、値の代わりに2つの引数を作成関数に渡すことによって中間オブジェクトをインスタンス化します。いつものように、この作成関数はデフォルトで中間クラスのコンストラクタになり、 `` creator``引数を使ってカスタマイズできます。</p>
<p>以下では、 `` UserKeyword``の例を変更して、 `` User.user_keywords``コレクションを辞書を使ってマッピングします。ここで `` UserKeyword.special_key``引数は辞書のキーとして使われます。 `` User.keywords``プロキシに `` creator``引数を適用して、新しい要素が辞書に追加されたときにこれらの値が適切に割り当てられるようにします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">backref</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.associationproxy</span> <span class="k">import</span> <span class="n">association_proxy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm.collections</span> <span class="k">import</span> <span class="n">attribute_mapped_collection</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

    <span class="c1"># proxy to &#39;user_keywords&#39;, instantiating UserKeyword</span>
    <span class="c1"># assigning the new key to &#39;special_key&#39;, values to</span>
    <span class="c1"># &#39;keyword&#39;.</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s1">&#39;user_keywords&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">,</span>
                    <span class="n">creator</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span>
                                <span class="n">UserKeyword</span><span class="p">(</span><span class="n">special_key</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="k">class</span> <span class="nc">UserKeyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user_keyword&#39;</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keyword_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;keyword.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">special_key</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>

    <span class="c1"># bidirectional user/user_keywords relationships, mapping</span>
    <span class="c1"># user_keywords with a dictionary against &quot;special_key&quot; as key.</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span>
                    <span class="s2">&quot;user_keywords&quot;</span><span class="p">,</span>
                    <span class="n">collection_class</span><span class="o">=</span><span class="n">attribute_mapped_collection</span><span class="p">(</span><span class="s2">&quot;special_key&quot;</span><span class="p">),</span>
                    <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Keyword&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Keyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;keyword&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;keyword&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyword</span> <span class="o">=</span> <span class="n">keyword</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Keyword(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keyword</span><span class="p">)</span></pre></div>
</div>
<p>`` .keywords``コレクションを辞書として説明し、 `` UserKeyword.string_key``値を `` Keyword``オブジェクトにマッピングします:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;sk1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Keyword</span><span class="p">(</span><span class="s1">&#39;kw1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;sk2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Keyword</span><span class="p">(</span><span class="s1">&#39;kw2&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
<span class="go">{&#39;sk1&#39;: Keyword(&#39;kw1&#39;), &#39;sk2&#39;: Keyword(&#39;kw2&#39;)}</span></pre></div>
</div>
</div>
<div class="section" id="composite-association-proxies">
<span id="composite-association-proxy"></span><h2>複合アソシエーションプロキシ<a class="headerlink" href="#composite-association-proxies" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>これまでの関係からスカラー属性へのプロキシ、アソシエーションオブジェクト全体にわたるプロキシ、およびプロキシ辞書を例として、3つの手法を組み合わせて、文字列値を厳密に扱う <code class="docutils literal notranslate"><span class="pre">ユーザー</span> <span class="pre">&amp;#39;</span></code> keywords``辞書を作成することができます文字列 `` keyword``にマップされた `` special_key``の `` `` UserKeyword``と `` Keyword``クラスは完全に隠されています。これは、 `` UserKeyword``に存在するアソシエーションプロキシを参照する `` User``にアソシエーションプロキシを構築することによって実現されます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="k">import</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">backref</span>

<span class="kn">from</span> <span class="nn">sqlalchemy.ext.associationproxy</span> <span class="k">import</span> <span class="n">association_proxy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="k">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm.collections</span> <span class="k">import</span> <span class="n">attribute_mapped_collection</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

    <span class="c1"># the same &#39;user_keywords&#39;-&gt;&#39;keyword&#39; proxy as in</span>
    <span class="c1"># the basic dictionary example</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">association_proxy</span><span class="p">(</span>
                <span class="s1">&#39;user_keywords&#39;</span><span class="p">,</span>
                <span class="s1">&#39;keyword&#39;</span><span class="p">,</span>
                <span class="n">creator</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span>
                            <span class="n">UserKeyword</span><span class="p">(</span><span class="n">special_key</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="k">class</span> <span class="nc">UserKeyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;user_keyword&#39;</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keyword_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;keyword.id&#39;</span><span class="p">),</span>
                                                    <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">special_key</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span>
            <span class="s2">&quot;user_keywords&quot;</span><span class="p">,</span>
            <span class="n">collection_class</span><span class="o">=</span><span class="n">attribute_mapped_collection</span><span class="p">(</span><span class="s2">&quot;special_key&quot;</span><span class="p">),</span>
            <span class="n">cascade</span><span class="o">=</span><span class="s2">&quot;all, delete-orphan&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># the relationship to Keyword is now called</span>
    <span class="c1"># &#39;kw&#39;</span>
    <span class="n">kw</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;Keyword&quot;</span><span class="p">)</span>

    <span class="c1"># &#39;keyword&#39; is changed to be a proxy to the</span>
    <span class="c1"># &#39;keyword&#39; attribute of &#39;Keyword&#39;</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s1">&#39;kw&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Keyword</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;keyword&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">keyword</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="s1">&#39;keyword&#39;</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keyword</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyword</span> <span class="o">=</span> <span class="n">keyword</span></pre></div>
</div>
<p>`` User.keywords``は文字列から文字列への辞書になりました。ここで、 `` UserKeyword``と `` Keyword``オブジェクトはアソシエーションプロキシを使って透過的に作成され、削除されます。以下の例では、アソシエーションプロキシによって適切に処理される代入演算子の使用法を示しています。コレクション値にコレクション値を一度に適用する:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;sk1&#39;</span><span class="p">:</span><span class="s1">&#39;kw1&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="s1">&#39;sk2&#39;</span><span class="p">:</span><span class="s1">&#39;kw2&#39;</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
<span class="go">{&#39;sk1&#39;: &#39;kw1&#39;, &#39;sk2&#39;: &#39;kw2&#39;}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;sk3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;kw3&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="s1">&#39;sk2&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">keywords</span><span class="p">)</span>
<span class="go">{&#39;sk1&#39;: &#39;kw1&#39;, &#39;sk3&#39;: &#39;kw3&#39;}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># illustrate un-proxied usage</span>
<span class="gp">... </span><span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">user_keywords</span><span class="p">[</span><span class="s1">&#39;sk3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">kw</span><span class="p">)</span>
<span class="go">&lt;__main__.Keyword object at 0x12ceb90&gt;</span></pre></div>
</div>
<p>上記の例の注意点の1つは、 `` Keyword``オブジェクトが辞書セット操作ごとに作成されるため、その例ではタグ付けの一般的な要件である `` Keyword``オブジェクトの文字列名の一意性を維持できませんこのようなシナリオ。この使用例では、レシピ <cite>UniqueObject &lt;http://www.sqlalchemy.org/trac/wiki/UsageRecipes/UniqueObject&gt; `_、またはこれに類する作成戦略が推奨されています。これは、最初にルックアップを適用し、次に</cite> <cite>Keyword``クラスのコンストラクタに戦略を作成して、既に存在する</cite> <a href="#id1"><span class="problematic" id="id2">`</span></a>Keyword``が返されるようにします指定された名前がすでに存在する場合</p>
</div>
<div class="section" id="querying-with-association-proxies">
<h2>アソシエーションプロキシを使用したクエリ<a class="headerlink" href="#querying-with-association-proxies" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>：class： <cite>.AssociationProxy`は、基本的な：func：</cite> .relationship`とターゲット属性に関連するシンプルなSQL構築機能を備えています。例えば、：meth： <cite>.RelationshipProperty.Comparator.any`と：meth：</cite> .RelationshipProperty.Comparator.has`操作が利用可能であり、私たちの基本的な関連オブジェクトのような&amp;quot;入れ子&amp;quot;のEXISTS節を生成します例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">keyword</span><span class="o">=</span><span class="s1">&#39;jek&#39;</span><span class="p">)))</span>
<span class="go">SELECT user.id AS user_id, user.name AS user_name</span>
<span class="go">FROM user</span>
<span class="go">WHERE EXISTS (SELECT 1</span>
<span class="go">FROM user_keyword</span>
<span class="go">WHERE user.id = user_keyword.user_id AND (EXISTS (SELECT 1</span>
<span class="go">FROM keyword</span>
<span class="go">WHERE keyword.id = user_keyword.keyword_id AND keyword.keyword = :keyword_1)))</span></pre></div>
</div>
<p>スカラー属性へのプロキシの場合、 `` __eq __（） <a href="#id1"><span class="problematic" id="id2">``</span></a>がサポートされています:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">UserKeyword</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">UserKeyword</span><span class="o">.</span><span class="n">keyword</span> <span class="o">==</span> <span class="s1">&#39;jek&#39;</span><span class="p">))</span>
<span class="go">SELECT user_keyword.*</span>
<span class="go">FROM user_keyword</span>
<span class="go">WHERE EXISTS (SELECT 1</span>
<span class="go">    FROM keyword</span>
<span class="go">    WHERE keyword.id = user_keyword.keyword_id AND keyword.keyword = :keyword_1)</span></pre></div>
</div>
<p>`` .contains（） <a href="#id1"><span class="problematic" id="id2">``</span></a>はスカラーコレクションへのプロキシで利用可能です:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;jek&#39;</span><span class="p">)))</span>
<span class="go">SELECT user.*</span>
<span class="go">FROM user</span>
<span class="go">WHERE EXISTS (SELECT 1</span>
<span class="go">FROM userkeywords, keyword</span>
<span class="go">WHERE user.id = userkeywords.user_id</span>
<span class="go">    AND keyword.id = userkeywords.keyword_id</span>
<span class="go">    AND keyword.keyword = :keyword_1)</span></pre></div>
</div>
<p>：class： <cite>.AssociationProxy`は、star-argsコンテキストの：attr：</cite>〜.AssociationProxy.attr`属性を使って：meth： <a href="#id1"><span class="problematic" id="id2">`</span></a>.Query.join`で幾分手動で使用できます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">User</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">バージョン 0.7.3 で追加: </span>：attr： <a href="#id1"><span class="problematic" id="id2">`</span></a>〜.AssociationProxy.attr`属性は、star-argsコンテキスト内にあります。</p>
</div>
<p>：attr： <cite>〜.AssociationProxy.attr`は、attr：</cite> .AssociationProxy.local_attr`と：attr： <a href="#id1"><span class="problematic" id="id2">`</span></a>.AssociationProxy.remote_attr`で構成され、実際のプロキシ属性と同義であり、クエリにも使用できます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uka</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">UserKeyword</span><span class="p">)</span>
<span class="n">ka</span> <span class="o">=</span> <span class="n">aliased</span><span class="p">(</span><span class="n">Keyword</span><span class="p">)</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">join</span><span class="p">(</span><span class="n">uka</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">local_attr</span><span class="p">)</span><span class="o">.</span>\
        <span class="n">join</span><span class="p">(</span><span class="n">ka</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">remote_attr</span><span class="p">)</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">バージョン 0.7.3 で追加: </span>：attr： <cite>.AssociationProxy.local_attr`と：attr：</cite> .AssociationProxy.remote_attr`は、実際のプロキシ属性の同義語で、クエリに使用できます。</p>
</div>
</div>
<div class="section" id="api-documentation">
<h2>APIドキュメント<a class="headerlink" href="#api-documentation" title="このヘッドラインへのパーマリンク">¶</a></h2>
<dl class="function">
<dt id="sqlalchemy.ext.associationproxy.association_proxy">
<code class="descclassname">sqlalchemy.ext.associationproxy.</code><code class="descname">association_proxy</code><span class="sig-paren">(</span><em>target_collection</em>, <em>attr</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.association_proxy" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>ターゲットのメンバーの属性を参照するターゲット属性のビューを実装するPythonプロパティを返します。</p>
<p>返される値は、class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.AssociationProxy`のインスタンスです。</p>
<p>単純な値またはスカラー値のコレクションとして関係を表すPythonプロパティを実装します。プロキシされたプロパティは、ターゲット（list、dictまたはset）のコレクション型、または1対1の関係の場合は単純なスカラー値を模倣します。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><span class="target" id="sqlalchemy.ext.associationproxy.association_proxy.params.target_collection"></span><strong>target_collection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.association_proxy.params.target_collection">¶</a> -- プロキシする属性の名前。この属性は、通常は：func： <a href="#id1"><span class="problematic" id="id2">`</span></a>〜sqlalchemy.orm.relationship`によってマッピングされ、ターゲットコレクションにリンクしますが、多対1または非スカラ関係でもあります。</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.association_proxy.params.attr"></span><strong>attr</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.association_proxy.params.attr">¶</a> -- 関連する1つまたは複数のインスタンスの属性。たとえば、[obj1、obj2]のターゲットコレクションがある場合、このプロキシプロパティによって作成されるリストは、[getattr（obj1、* attr <em>）、getattr（obj2、</em> attr <em>）]のようになります。 -oneまたはそうでない場合はuselist = False、次に単純に：getattr（obj、</em> attr <a href="#id1"><span class="problematic" id="id2">*</span></a>）</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.association_proxy.params.creator"></span><strong>creator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.association_proxy.params.creator">¶</a> -- オプション。このプロキシされたコレクションに新しいアイテムが追加されると、ターゲットコレクションによって収集されたクラスの新しいインスタンスが作成されます。リストコレクションと集合コレクションの場合、新しいインスタンスの &amp;#39;value&amp;#39;を指定してターゲットクラスコンストラクターが呼び出されます。 dict型の場合、keyとvalueの2つの引数が渡されます。別々にインスタンスを構築したい場合は、上記のように引数をとり、インスタンスを返す* creator <a href="#id1"><span class="problematic" id="id2">*</span></a>関数を提供します。スカラー関係の場合、ターゲットがNoneの場合、creator（）が呼び出されます。ターゲットが存在する場合、set操作は関連オブジェクトのsetattr（）にプロキシされます。複数の属性を持つ関連オブジェクトがある場合は、複数の関連プロキシを異なる属性にマッピングするように設定できます。サンプルについては単体テストを参照し、この状況でオンデマンドでスカラー関係を構築するためにcreator（）関数をどのように使用できるかについての例を参照してください。</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.association_proxy.params.**kw"></span><strong>**kw</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.association_proxy.params.**kw">¶</a> -- ほかのキーワード引数をclass： <a href="#id1"><span class="problematic" id="id2">`</span></a>.AssociationProxy`に渡します。</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy">
<em class="property">class </em><code class="descclassname">sqlalchemy.ext.associationproxy.</code><code class="descname">AssociationProxy</code><span class="sig-paren">(</span><em>target_collection</em>, <em>attr</em>, <em>creator=None</em>, <em>getset_factory=None</em>, <em>proxy_factory=None</em>, <em>proxy_bulk_set=None</em>, <em>info=None</em>, <em>cascade_scalar_deletes=False</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="../internals.html#sqlalchemy.orm.base.InspectionAttrInfo" title="sqlalchemy.orm.base.InspectionAttrInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">sqlalchemy.orm.base.InspectionAttrInfo</span></code></a></p>
<p>オブジェクト属性の読み取り/書き込みビューを表す記述子。</p>
<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.__eq__">
<code class="descname">__eq__</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.__eq__" title="この定義へのパーマリンク">¶</a></dt>
<dd><div class="inherited-member docutils container">
<em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">__eq__</span></code> <em>attribute of</em> <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></div>
<p>Return self==value.</p>
</dd></dl>

<dl class="method">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>target_collection</em>, <em>attr</em>, <em>creator=None</em>, <em>getset_factory=None</em>, <em>proxy_factory=None</em>, <em>proxy_bulk_set=None</em>, <em>info=None</em>, <em>cascade_scalar_deletes=False</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Construct a new <a class="reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy" title="sqlalchemy.ext.associationproxy.AssociationProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">AssociationProxy</span></code></a>.</p>
<p>The <a class="reference internal" href="#sqlalchemy.ext.associationproxy.association_proxy" title="sqlalchemy.ext.associationproxy.association_proxy"><code class="xref py py-func docutils literal notranslate"><span class="pre">association_proxy()</span></code></a> function is provided as the usual
entrypoint here, though <a class="reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy" title="sqlalchemy.ext.associationproxy.AssociationProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">AssociationProxy</span></code></a> can be instantiated
and/or subclassed directly.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><span class="target" id="sqlalchemy.ext.associationproxy.AssociationProxy.params.target_collection"></span><strong>target_collection</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy.params.target_collection">¶</a> -- Name of the collection we'll proxy to,
usually created with <a class="reference internal" href="../relationship_api.html#sqlalchemy.orm.relationship" title="sqlalchemy.orm.relationship"><code class="xref py py-func docutils literal notranslate"><span class="pre">relationship()</span></code></a>.</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.AssociationProxy.params.attr"></span><strong>attr</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy.params.attr">¶</a> -- Attribute on the collected instances we'll proxy
for.  For example, given a target collection of [obj1, obj2], a
list created by this proxy property would look like
[getattr(obj1, attr), getattr(obj2, attr)]</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.AssociationProxy.params.creator"></span><strong>creator</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy.params.creator">¶</a> -- <p>Optional. When new items are added to this proxied
collection, new instances of the class collected by the target
collection will be created.  For list and set collections, the
target class constructor will be called with the 'value' for the
new instance.  For dict types, two arguments are passed:
key and value.</p>
<p>If you want to construct instances differently, supply a 'creator'
function that takes arguments as above and returns instances.</p>
</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.AssociationProxy.params.cascade_scalar_deletes"></span><strong>cascade_scalar_deletes</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy.params.cascade_scalar_deletes">¶</a> -- <p>when True, indicates that setting
the proxied value to <code class="docutils literal notranslate"><span class="pre">None</span></code>, or deleting it via <code class="docutils literal notranslate"><span class="pre">del</span></code>, should
also remove the source object.  Only applies to scalar attributes.
Normally, removing the proxied target will not remove the proxy
source, as this object may have other state that is still to be
kept.</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 1.3 で追加.</span></p>
</div>
</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.AssociationProxy.params.getset_factory"></span><strong>getset_factory</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy.params.getset_factory">¶</a> -- <p>Optional.  Proxied attribute access is
automatically handled by routines that get and set values based on
the <cite>attr</cite> argument for this proxy.</p>
<p>If you would like to customize this behavior, you may supply a
<cite>getset_factory</cite> callable that produces a tuple of <cite>getter</cite> and
<cite>setter</cite> functions.  The factory is called with two arguments, the
abstract type of the underlying collection and this proxy instance.</p>
</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.AssociationProxy.params.proxy_factory"></span><strong>proxy_factory</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy.params.proxy_factory">¶</a> -- Optional.  The type of collection to emulate is
determined by sniffing the target collection.  If your collection
type can't be determined by duck typing or you'd like to use a
different collection implementation, you may supply a factory
function to produce those collections.  Only applicable to
non-scalar relationships.</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.AssociationProxy.params.proxy_bulk_set"></span><strong>proxy_bulk_set</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy.params.proxy_bulk_set">¶</a> -- Optional, use with proxy_factory.  See
the _set() method for details.</li>
<li><span class="target" id="sqlalchemy.ext.associationproxy.AssociationProxy.params.info"></span><strong>info</strong><a class="paramlink headerlink reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy.params.info">¶</a> -- <p>optional, will be assigned to
<a class="reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy.info" title="sqlalchemy.ext.associationproxy.AssociationProxy.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">AssociationProxy.info</span></code></a> if present.</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 1.0.9 で追加.</span></p>
</div>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.__le__">
<code class="descname">__le__</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.__le__" title="この定義へのパーマリンク">¶</a></dt>
<dd><div class="inherited-member docutils container">
<em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">__le__</span></code> <em>attribute of</em> <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></div>
<p>Return self&lt;=value.</p>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.__lt__">
<code class="descname">__lt__</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.__lt__" title="この定義へのパーマリンク">¶</a></dt>
<dd><div class="inherited-member docutils container">
<em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">__lt__</span></code> <em>attribute of</em> <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></div>
<p>Return self&lt;value.</p>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.__ne__">
<code class="descname">__ne__</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.__ne__" title="この定義へのパーマリンク">¶</a></dt>
<dd><div class="inherited-member docutils container">
<em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">__ne__</span></code> <em>attribute of</em> <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></div>
<p>Return self!=value.</p>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.extension_type">
<code class="descname">extension_type</code><em class="property"> = symbol('ASSOCIATION_PROXY')</em><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.extension_type" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.for_class">
<code class="descname">for_class</code><span class="sig-paren">(</span><em>class_</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.for_class" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>ローカルの内部状態を特定のマップされたクラスに戻します。</p>
<p>例えば、クラス `` User``を与えられます:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="c1"># ...</span>

    <span class="n">keywords</span> <span class="o">=</span> <span class="n">association_proxy</span><span class="p">(</span><span class="s1">&#39;kws&#39;</span><span class="p">,</span> <span class="s1">&#39;keyword&#39;</span><span class="p">)</span></pre></div>
</div>
<p>：attr： <cite>.Mapper.all_orm_descriptors`からthis：class：</cite> .AssociationProxy`にアクセスすると、このプロキシのターゲットクラスを `` User``：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inspect</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">all_orm_descriptors</span><span class="p">[</span><span class="s2">&quot;keywords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">for_class</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">target_class</span></pre></div>
</div>
<p>これは、 `` User``クラスに固有の：class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.AssociationProxyInstance`のインスタンスを返します。 ：class： <a href="#id3"><span class="problematic" id="id4">`</span></a>.AssociationProxy`オブジェクトは、その親クラスにとらわれないままです。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 1.3 で追加: </span>- <a class="reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy" title="sqlalchemy.ext.associationproxy.AssociationProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">AssociationProxy</span></code></a> no longer stores
any state specific to a particular parent class; the state is now
stored in per-class <a class="reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance" title="sqlalchemy.ext.associationproxy.AssociationProxyInstance"><code class="xref py py-class docutils literal notranslate"><span class="pre">AssociationProxyInstance</span></code></a> objects.</p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.info">
<code class="descname">info</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.info" title="この定義へのパーマリンク">¶</a></dt>
<dd><div class="inherited-member docutils container">
<em>inherited from the</em> <a class="reference internal" href="../internals.html#sqlalchemy.orm.base.InspectionAttrInfo.info" title="sqlalchemy.orm.base.InspectionAttrInfo.info"><code class="xref py py-attr docutils literal notranslate"><span class="pre">info</span></code></a> <em>attribute of</em> <a class="reference internal" href="../internals.html#sqlalchemy.orm.base.InspectionAttrInfo" title="sqlalchemy.orm.base.InspectionAttrInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">InspectionAttrInfo</span></code></a></div>
<p>オブジェクトに関連付けられた情報ディクショナリで、ユーザ定義のデータをこの：class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.InspectionAttr`に関連付けることができます。</p>
<p>辞書は、最初にアクセスされたときに生成されます。あるいは、：func： <cite>.column_property</cite>、：func：` .relationship`、または：func： <a href="#id1"><span class="problematic" id="id2">`</span></a>.composite`関数のコンストラクタ引数として指定することもできます。</p>
<div class="versionadded">
<p><span class="versionmodified">バージョン 0.8 で追加: </span>.infoのサポートをall：class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.MapperProperty`サブクラスに追加しました。</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified">バージョン 1.0.0 で変更: </span>：attr： <cite>.MapperProperty.info`は：attr：</cite> .InspectionAttrInfo.info`属性を使って拡張タイプでも利用できます。これにより、より多様なORMと拡張構造に適用できます。</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p>：attr： <cite>.QueryableAttribute.info</cite></p>
<p class="last">：のAttr： <cite>.SchemaItem.info</cite></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.is_aliased_class">
<code class="descname">is_aliased_class</code><em class="property"> = False</em><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.is_aliased_class" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.is_attribute">
<code class="descname">is_attribute</code><em class="property"> = False</em><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.is_attribute" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.is_clause_element">
<code class="descname">is_clause_element</code><em class="property"> = False</em><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.is_clause_element" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.is_instance">
<code class="descname">is_instance</code><em class="property"> = False</em><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.is_instance" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.is_mapper">
<code class="descname">is_mapper</code><em class="property"> = False</em><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.is_mapper" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.is_property">
<code class="descname">is_property</code><em class="property"> = False</em><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.is_property" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxy.is_selectable">
<code class="descname">is_selectable</code><em class="property"> = False</em><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxy.is_selectable" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance">
<em class="property">class </em><code class="descclassname">sqlalchemy.ext.associationproxy.</code><code class="descname">AssociationProxyInstance</code><span class="sig-paren">(</span><em>parent</em>, <em>owning_class</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>クラス固有およびオブジェクト固有の結果を提供するクラスごとのオブジェクト。</p>
<p>これは、class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.AssociationProxy`がクラスの特定のクラスまたはインスタンスに関して呼び出されたとき、つまりそれが通常のPython記述子として使用されるときに使用されます。</p>
<p>通常のPython記述子として：class： <cite>.AssociationProxy`を参照する場合、：class：</cite> .AssociationProxyInstance`は実際に情報を提供するオブジェクトです。通常の状況下では、その存在は透過的です:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">keywords</span><span class="o">.</span><span class="n">scalar</span>
<span class="go">False</span></pre></div>
</div>
<p>特別な場合：class： <cite>.AssociationProxy`オブジェクトが直接アクセスされている場合、：class：</cite> .AssociationProxyInstance`への明示的なハンドルを取得するには、：meth： <a href="#id1"><span class="problematic" id="id2">`</span></a>.AssociationProxy.for_class`メソッドを使用します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proxy_state</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">all_orm_descriptors</span><span class="p">[</span><span class="s2">&quot;keywords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">for_class</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>

<span class="c1"># view if proxy object is scalar or not</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">proxy_state</span><span class="o">.</span><span class="n">scalar</span>
<span class="kc">False</span></pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">バージョン 1.3 で追加.</span></p>
</div>
<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.__le__">
<code class="descname">__le__</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.__le__" title="この定義へのパーマリンク">¶</a></dt>
<dd><div class="inherited-member docutils container">
<em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">__le__</span></code> <em>attribute of</em> <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></div>
<p>Return self&lt;=value.</p>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.__lt__">
<code class="descname">__lt__</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.__lt__" title="この定義へのパーマリンク">¶</a></dt>
<dd><div class="inherited-member docutils container">
<em>inherited from the</em> <code class="xref py py-attr docutils literal notranslate"><span class="pre">__lt__</span></code> <em>attribute of</em> <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></div>
<p>Return self&lt;value.</p>
</dd></dl>

<dl class="method">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.any">
<code class="descname">any</code><span class="sig-paren">(</span><em>criterion=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.any" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>EXISTSを使用してプロキシされた「任意の」表現を生成します。</p>
<p>この式は、基本的なプロキシ属性の：meth： <cite>.RelationshipProperty.Comparator.any`および/または：meth：</cite> .RelationshipProperty.Comparator.has`演算子を使用して合成されたプロダクトになります。</p>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.attr">
<code class="descname">attr</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.attr" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a href="#id1"><span class="problematic" id="id2">``</span></a>（local_attr、remote_attr） <a href="#id3"><span class="problematic" id="id4">``</span></a>のタプルを返します。</p>
<p>この属性は、2つの関係間で：meth： <a href="#id1"><span class="problematic" id="id2">`</span></a>.Query.join`を使用して結合を指定するときに便利です:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sess</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Parent</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="o">*</span><span class="n">Parent</span><span class="o">.</span><span class="n">proxied</span><span class="o">.</span><span class="n">attr</span><span class="p">)</span></pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p>：attr： <cite>.AssociationProxyInstance.local_attr</cite></p>
<p class="last">：attr： <cite>.AssociationProxyInstance.remote_attr</cite></p>
</div>
</dd></dl>

<dl class="method">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.contains">
<code class="descname">contains</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.contains" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>EXISTSを使用してプロキシの「包含」表現を生成します。</p>
<p>この式は、：meth： <cite>.RelationshipProperty.Comparator.any</cite>、：meth：` .RelationshipProperty.Comparator.has`、および/または：meth： <a href="#id1"><span class="problematic" id="id2">`</span></a>.RelationshipProperty.Comparator.contains`演算子を使用した合成済みの式です。基になるプロキシ属性。</p>
</dd></dl>

<dl class="method">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.delete">
<code class="descname">delete</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.delete" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.get" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.has">
<code class="descname">has</code><span class="sig-paren">(</span><em>criterion=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.has" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>EXISTSを使用してプロキシされた「持っている」表現を生成する。</p>
<p>この式は、基本的なプロキシ属性の：meth： <cite>.RelationshipProperty.Comparator.any`および/または：meth：</cite> .RelationshipProperty.Comparator.has`演算子を使用して合成されたプロダクトになります。</p>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.info">
<code class="descname">info</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.info" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.local_attr">
<code class="descname">local_attr</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.local_attr" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>this：class： <cite>.AssociationProxyInstance`によって参照される &amp;#39;local&amp;#39;：class：</cite> .MapperProperty`です。</p>
<div class="admonition seealso">
<p class="first admonition-title">参考</p>
<p>：attr： <cite>.AssociationProxyInstance.attr</cite></p>
<p class="last">：attr： <cite>.AssociationProxyInstance.remote_attr</cite></p>
</div>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.remote_attr">
<code class="descname">remote_attr</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.remote_attr" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>this：class： <cite>.AssociationProxyInstance`によって参照される &amp;#39;remote&amp;#39;：class：</cite> .MapperProperty`です。</p>
<p>..seealso</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>:attr:`.AssociationProxyInstance.attr`

:attr:`.AssociationProxyInstance.local_attr`</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.scalar">
<code class="descname">scalar</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.scalar" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>次のような場合は `` True``を返します。class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.AssociationProxyInstance`はローカル側でスカラ関係を代理します。</p>
</dd></dl>

<dl class="method">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.set">
<code class="descname">set</code><span class="sig-paren">(</span><em>obj</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.set" title="この定義へのパーマリンク">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="sqlalchemy.ext.associationproxy.AssociationProxyInstance.target_class">
<code class="descname">target_class</code><a class="headerlink" href="#sqlalchemy.ext.associationproxy.AssociationProxyInstance.target_class" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>中間クラスはthis：class： <a href="#id1"><span class="problematic" id="id2">`</span></a>.AssociationProxyInstance`によって処理されます。</p>
<p>インターセプトされた追加/設定/割り当てイベントにより、このクラスの新しいインスタンスが生成されます。</p>
</dd></dl>

</dd></dl>

<dl class="data">
<dt id="sqlalchemy.ext.associationproxy.ASSOCIATION_PROXY">
<code class="descclassname">sqlalchemy.ext.associationproxy.</code><code class="descname">ASSOCIATION_PROXY</code><em class="property"> = symbol('ASSOCIATION_PROXY')</em><a class="headerlink" href="#sqlalchemy.ext.associationproxy.ASSOCIATION_PROXY" title="この定義へのパーマリンク">¶</a></dt>
<dd><dl class="docutils">
<dt>Symbol indicating an <code class="xref py py-class docutils literal notranslate"><span class="pre">InspectionAttr</span></code> that's</dt>
<dd>of type <a class="reference internal" href="#sqlalchemy.ext.associationproxy.AssociationProxy" title="sqlalchemy.ext.associationproxy.AssociationProxy"><code class="xref py py-class docutils literal notranslate"><span class="pre">AssociationProxy</span></code></a>.</dd>
</dl>
<p>Is assigned to the <a class="reference internal" href="../internals.html#sqlalchemy.orm.base.InspectionAttr.extension_type" title="sqlalchemy.orm.base.InspectionAttr.extension_type"><code class="xref py py-attr docutils literal notranslate"><span class="pre">InspectionAttr.extension_type</span></code></a>
attibute.</p>
</dd></dl>

</div>
</div>

    </div>

</div>

<div id="docs-bottom-navigation" class="docs-navigation-links, withsidebar">
        Previous:
        <a href="index.html" title="previous chapter">ORM拡張</a>
        Next:
        <a href="automap.html" title="next chapter">オートマップ</a>

    <div id="docs-copyright">
        &copy; <a href="../../copyright.html">Copyright</a> 2007-2018, the SQLAlchemy authors and contributors.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.1.
    </div>
</div>

</div>



        
        

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
          URL_ROOT:    '../../',
          VERSION:     '1.3.0b1',
          COLLAPSE_MODINDEX: false,
          FILE_SUFFIX: '.html'
      };
    </script>

    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>

    <!-- begin iterate through sphinx environment script_files -->
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- end iterate through sphinx environment script_files -->

    <script type="text/javascript" src="../../_static/detectmobile.js"></script>
    <script type="text/javascript" src="../../_static/init.js"></script>


    </body>
</html>


